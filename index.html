
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QA Team Dashboard</title>
    <style>
        :root {
            --primary-color: #007bff;
            --secondary-color: #6c757d;
            --background-color: #1a2526;
            --widget-background: #2e3f52;
            --text-color: #f5f5f5;
            --shadow: 0 2px 6px rgba(0, 0, 0, 0.4);
            --border-radius: 6px;
            --light-background: #f0f2f5;
            --light-widget: #ffffff;
            --light-text: #333;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }

        body {
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            transition: background-color 0.3s, color 0.3s;
        }

        body.light-mode {
            background-color: var(--light-background);
            color: var(--light-text);
        }

        body.light-mode .sidebar,
        body.light-mode .widget,
        body.light-mode .header,
        body.light-mode .kanban-column,
        body.light-mode .modal-content,
        body.light-mode .list-item,
        body.light-mode .category-item,
        body.light-mode .subcategory-item,
        body.light-mode td,
        body.light-mode .sidebar-item,
        body.light-mode .widget h3,
        body.light-mode .kanban-column h3,
        body.light-mode .form-group label,
        body.light-mode .stats-number,
        body.light-mode .stats-list {
            background-color: var(--light-widget);
            color: var(--light-text);
        }

        body.light-mode th {
            background-color: #e9ecef;
            color: var(--light-text);
        }

        body.light-mode .sidebar-item:hover,
        body.light-mode .sidebar-item.active {
            color: #fff;
        }

        body.light-mode .slider .moon,
        body.light-mode .slider .sun {
            color: var(--light-text);
        }

        body.light-mode .container {
            --uib-color: black;
        }

        body:not(.light-mode) .container {
            --uib-color: white;
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 250px;
            background-color: var(--background-color);
            padding: 20px;
            box-shadow: var(--shadow);
            transition: width 0.3s, background-color 0.3s;
        }

        .sidebar.collapsed {
            width: 60px;
        }

        .sidebar.collapsed .sidebar-item span {
            display: none;
        }

        .sidebar.collapsed .sidebar-item {
            justify-content: center;
        }

        .sidebar.collapsed .sidebar-item.active {
            background-color: var(--primary-color);
            color: #fff;
            border-radius: var(--border-radius);
            width: 40px;
            height: 40px;
        }

        .sidebar-item {
            padding: 14px 18px;
            margin-bottom: 10px;
            cursor: pointer;
            border-radius: var(--border-radius);
            transition: background-color 0.3s;
            color: var(--text-color);
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sidebar-item:hover,
        .sidebar-item.active {
            background-color: var(--primary-color);
            color: #fff;
        }

        .sidebar-toggle {
            font-size: 20px;
            cursor: pointer;
            margin-bottom: 20px;
            color: var(--text-color);
        }

        .main-content {
            flex: 1;
            padding: 25px;
            overflow-y: auto;
        }

        .breadcrumbs {
            margin-bottom: 15px;
            font-size: 14px;
            color: var(--secondary-color);
        }

        .breadcrumbs a {
            color: var(--primary-color);
            text-decoration: none;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 25px;
            background-color: var(--widget-background);
            box-shadow: var(--shadow);
            margin-bottom: 25px;
            border-radius: var(--border-radius);
            transition: background-color 0.3s;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .header-left img {
            height: 40px;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
            font-size: 16px;
        }

        .user-avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-size: 14px;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: #fff;
            border: none;
            padding: 10px 20px;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: background-color 0.3s;
            font-size: 14px;
        }

        .btn-primary:hover {
            background-color: #0056b3;
        }

        .btn-danger {
            background-color: #dc3545;
            color: #fff;
            border: none;
            padding: 10px 20px;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: background-color 0.3s;
            font-size: 14px;
        }

        .btn-danger:hover {
            background-color: #c82333;
        }

        .theme-switch-wrapper {
            display: flex;
            align-items: center;
        }

        .theme-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .theme-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #34495e;
            transition: 0.4s;
            border-radius: 34px;
            overflow: hidden;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: #ccc;
            transition: 0.4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #f1c40f;
        }

        input:checked + .slider:before {
            transform: translateX(26px);
            background-color: #fff;
        }

        .slider .moon,
        .slider .sun {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            font-size: 16px;
            transition: opacity 0.4s;
        }

        .slider .moon {
            left: 10px;
            opacity: 1;
            color: #fff;
        }

        .slider .sun {
            right: 10px;
            opacity: 0;
            color: #fff;
        }

        input:checked + .slider .moon {
            opacity: 0;
        }

        input:checked + .slider .sun {
            opacity: 1;
        }

        .loader-container {
            --uib-size: 40px;
            --uib-color: white;
            --uib-speed: .9s;
            --uib-center: calc(var(--uib-size) / 2 - var(--uib-size) / 5 / 2);
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: none;
            align-items: center;
            justify-content: flex-start;
            height: var(--uib-size);
            width: var(--uib-size);
            animation: rotate calc(var(--uib-speed) * 3) linear infinite;
            z-index: 1002;
        }

        .dot {
            position: absolute;
            top: 0;
            left: 0;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            height: 100%;
            width: 100%;
        }

        .dot::before {
            content: '';
            height: 20%;
            width: 20%;
            border-radius: 50%;
            background-color: var(--uib-color);
            animation: oscillate var(--uib-speed) ease-in-out infinite alternate;
            transition: background-color 0.3s ease;
        }

        .dot:nth-child(1)::before { transform: translateX(var(--uib-center)); }
        .dot:nth-child(2) { transform: rotate(45deg); }
        .dot:nth-child(2)::before { transform: translateX(var(--uib-center)); animation-delay: calc(var(--uib-speed) * -0.125); }
        .dot:nth-child(3) { transform: rotate(90deg); }
        .dot:nth-child(3)::before { transform: translateX(var(--uib-center)); animation-delay: calc(var(--uib-speed) * -0.25); }
        .dot:nth-child(4) { transform: rotate(135deg); }
        .dot:nth-child(4)::before { transform: translateX(var(--uib-center)); animation-delay: calc(var(--uib-speed) * -0.375); }
        .dot:nth-child(5) { transform: rotate(180deg); }
        .dot:nth-child(5)::before { transform: translateX(var(--uib-center)); animation-delay: calc(var(--uib-speed) * -0.5); }
        .dot:nth-child(6) { transform: rotate(225deg); }
        .dot:nth-child(6)::before { transform: translateX(var(--uib-center)); animation-delay: calc(var(--uib-speed) * -0.625); }
        .dot:nth-child(7) { transform: rotate(270deg); }
        .dot:nth-child(7)::before { transform: translateX(var(--uib-center)); animation-delay: calc(var(--uib-speed) * -0.75); }
        .dot:nth-child(8) { transform: rotate(315deg); }
        .dot:nth-child(8)::before { transform: translateX(var(--uib-center)); animation-delay: calc(var(--uib-speed) * -0.875); }

        @keyframes oscillate {
            0% { transform: translateX(var(--uib-center)) scale(0); opacity: 0.25; }
            100% { transform: translateX(0) scale(1); opacity: 1; }
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .tab-pane {
            display: none;
        }

        .tab-pane.active {
            display: block;
        }

        .widget {
            background-color: var(--widget-background);
            padding: 25px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 25px;
            transition: background-color 0.3s;
        }

        .widget h3 {
            font-size: 20px;
            margin-bottom: 20px;
            color: var(--text-color);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
        }

        .stats {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .stats-number {
            font-size: 36px;
            font-weight: bold;
            color: var(--text-color);
        }

        .stats-list {
            font-size: 16px;
        }

        .stats-list-item {
            margin-bottom: 10px;
        }

        .kanban-board {
            display: flex;
            gap: 25px;
        }

        .kanban-column {
            flex: 1;
            background-color: var(--widget-background);
            padding: 25px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            min-height: 300px;
            transition: background-color 0.3s;
        }

        .kanban-column.todo { border-left: 4px solid #ffc107; }
        .kanban-column.in-progress { border-left: 4px solid #fd7e14; }
        .kanban-column.done { border-left: 4px solid #28a745; }
        .kanban-column.dragover { background-color: #3b4d64; }

        .kanban-column h3 {
            font-size: 20px;
            margin-bottom: 20px;
            color: var(--text-color);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background-color: var(--widget-background);
            box-shadow: var(--shadow);
            border-radius: var(--border-radius);
            overflow: hidden;
            table-layout: auto;
            transition: background-color 0.3s;
        }

        th, td {
            padding: 14px 18px;
            text-align: left;
            border-bottom: 1px solid #444;
            font-size: 14px;
            color: var(--text-color);
            white-space: normal;
            word-wrap: break-word;
            min-width: 120px;
        }

        th {
            background-color: var(--primary-color);
            color: #fff;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 14px;
            padding: 12px 18px;
            position: sticky;
            top: 0;
            z-index: 1;
            cursor: pointer;
        }

        th:hover {
            background-color: #0056b3;
        }

        td {
            background-color: #34495e;
            transition: background-color 0.3s;
        }

        body.light-mode td {
            background-color: #f9f9f9;
        }

        tr:nth-child(even) td {
            background-color: #3e5c76;
        }

        body.light-mode tr:nth-child(even) td {
            background-color: #e9ecef;
        }

        tr:hover td {
            background-color: #4a6a8a;
        }

        body.light-mode tr:hover td {
            background-color: #d1d8e0;
        }

        td select, td input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 14px;
            width: 100%;
            background-color: #fff;
            color: #333;
            box-sizing: border-box;
        }

        td input[type="number"] {
            width: 60px;
        }

        .bug-high { color: #dc3545; font-weight: bold; }
        .bug-medium { color: #fd7e14; }
        .bug-low { color: #28a745; }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background-color: var(--widget-background);
            padding: 25px;
            border-radius: var(--border-radius);
            width: 450px;
            max-width: 90%;
            position: relative;
            color: var(--text-color);
            transition: background-color 0.3s;
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            cursor: pointer;
            font-size: 24px;
            color: var(--text-color);
        }

        .notification {
            display: none;
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: var(--primary-color);
            color: #fff;
            padding: 12px 25px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            font-size: 16px;
            z-index: 1001;
        }

        .error-notification {
            background-color: #dc3545;
        }

        form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-group label {
            font-size: 14px;
            color: var(--text-color);
        }

        .form-group label.required::after {
            content: '*';
            color: #dc3545;
            margin-left: 4px;
        }

        input, select, textarea {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 14px;
            width: 100%;
            background-color: #fff;
            color: #333;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 4px var(--primary-color);
        }

        select {
            appearance: none;
            background: url('data:image/svg+xml;utf8,<svg fill="gray" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>') no-repeat right 10px center;
            background-size: 16px;
        }

        .list-item {
            background-color: var(--widget-background);
            padding: 14px;
            margin-bottom: 10px;
            border-radius: var(--border-radius);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 16px;
            transition: background-color 0.3s;
        }

        .category-item {
            background-color: var(--widget-background);
            padding: 14px;
            margin-bottom: 10px;
            border-radius: var(--border-radius);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 16px;
            transition: background-color 0.3s;
        }

        .subcategory-list {
            margin-left: 25px;
            margin-bottom: 25px;
        }

        .subcategory-item {
            background-color: #34495e;
            padding: 10px;
            margin-bottom: 6px;
            border-radius: var(--border-radius);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
            transition: background-color 0.3s;
        }

        body.light-mode .subcategory-item {
            background-color: #e9ecef;
        }

        h2 {
            font-size: 26px;
            margin-bottom: 25px;
            color: var(--text-color);
        }

        .search-bar {
            margin-bottom: 20px;
        }

        .search-bar input {
            padding: 10px;
            width: 100%;
            max-width: 300px;
        }

        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                padding: 10px;
            }

            .sidebar.collapsed {
                width: 50px;
                position: fixed;
                height: 100%;
                z-index: 100;
            }

            .main-content {
                padding: 15px;
                margin-left: 0;
            }

            .header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .header-right {
                flex-direction: column;
                align-items: flex-start;
            }

            .kanban-board {
                flex-direction: column;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            table {
                display: block;
                overflow-x: auto;
                white-space: nowrap;
                font-size: 12px;
            }

            th, td {
                min-width: 100px;
            }

            .modal-content {
                width: 90%;
                max-width: none;
            }
        }

        @media (max-width: 480px) {
            .sidebar-toggle {
                font-size: 16px;
            }

            .sidebar-item {
                padding: 10px;
                font-size: 14px;
            }

            .header-left img {
                height: 30px;
            }

            .btn-primary, .btn-danger {
                padding: 8px 15px;
                font-size: 12px;
            }

            h2 {
                font-size: 20px;
            }

            .form-group input,
            .form-group select,
            .form-group textarea {
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <div class="sidebar-toggle" onclick="toggleSidebar()">‚ò∞</div>
            <div class="sidebar-item active" data-tab="dashboard"><span>üìä Dashboard</span></div>
            <div class="sidebar-item" data-tab="daily-standup"><span>üìÖ Daily Standup</span></div>
            <div class="sidebar-item" data-tab="kanban-board"><span>üìã Kanban Board</span></div>
            <div class="sidebar-item team-lead-only" data-tab="project-management"><span>üèóÔ∏è Projects</span></div>
            <div class="sidebar-item" data-tab="project-overview"><span>üîç Project Overview</span></div>
            <div class="sidebar-item" data-tab="approved-projects"><span>‚úÖ Approved Projects</span></div>
            <div class="sidebar-item" data-tab="rejected-projects"><span>‚ùå Rejected Projects</span></div>
            <div class="sidebar-item team-lead-admin" data-tab="project-types"><span>üìë Project Types</span></div>
            <div class="sidebar-item team-lead-admin" data-tab="qa-report"><span>üìà QA Report</span></div>
            <div class="sidebar-item team-lead-only" data-tab="activity-log"><span>üïí Activity Log</span></div>
            <div class="sidebar-item" data-tab="profile"><span>üë§ Profile</span></div>
            <div class="sidebar-item team-lead-only" data-tab="user-management"><span>üë• User Management</span></div>
            <div class="sidebar-item team-lead-only" data-tab="assign-roles"><span>üîë Assign Roles</span></div>
        </div>
        <div class="main-content">
            <div class="header">
                <div class="header-left">
                    <img src="images/logo.png" alt="Intersmart Logo">
                    <span style="font-size: 18px; font-weight: bold;">QA Team Dashboard</span>
                </div>
                <div class="header-right">
                    <div class="user-avatar" id="user-avatar"></div>
                    <span id="user-name"></span>
                    <div class="theme-switch-wrapper">
                        <label class="theme-switch" for="theme-checkbox">
                            <input type="checkbox" id="theme-checkbox" onchange="toggleTheme()">
                            <span class="slider">
                                <span class="moon">üåô‚ú®</span>
                                <span class="sun">‚òÄÔ∏è</span>
                            </span>
                        </label>
                    </div>
                    <button class="btn-primary" onclick="logout()">Logout</button>
                </div>
            </div>
            <div class="breadcrumbs" id="breadcrumbs"></div>
            <div id="notification" class="notification"></div>
            <div id="loader" class="loader-container">
                <div class="dot"></div>
                <div class="dot"></div>
                <div class="dot"></div>
                <div class="dot"></div>
                <div class="dot"></div>
                <div class="dot"></div>
                <div class="dot"></div>
                <div class="dot"></div>
            </div>
            <div id="dashboard" class="tab-pane active">
                <h2>Welcome, <span id="welcome-user"></span>!</h2>
                <div id="dashboard-content" class="stats-grid"></div>
            </div>
            <div id="daily-standup" class="tab-pane">
                <h2>Daily Standup</h2>
                <form id="standup-form">
                    <div class="form-group">
                        <label for="standup-yesterday" class="required">Yesterday‚Äôs Work</label>
                        <input type="text" id="standup-yesterday" placeholder="What did you do yesterday?" required>
                    </div>
                    <div class="form-group">
                        <label for="standup-today" class="required">Today‚Äôs Plan</label>
                        <input type="text" id="standup-today" placeholder="What will you do today?" required>
                    </div>
                    <div class="form-group">
                        <label for="standup-blockers">Blockers</label>
                        <input type="text" id="standup-blockers" placeholder="Any blockers?">
                    </div>
                    <button type="submit" class="btn-primary">Submit Standup</button>
                </form>
            </div>
            <div id="kanban-board" class="tab-pane">
                <h2>Kanban Board</h2>
                <button class="btn-primary" onclick="showTaskForm()" style="margin-bottom: 25px;">Add Task</button>
                <div class="kanban-board">
                    <div class="kanban-column todo" ondrop="drop(event, 'To Do')" ondragover="allowDrop(event)" ondragenter="dragEnter(event)" ondragleave="dragLeave(event)">
                        <h3>To Do</h3>
                        <div id="to-do-tasks"></div>
                    </div>
                    <div class="kanban-column in-progress" ondrop="drop(event, 'In Progress')" ondragover="allowDrop(event)" ondragenter="dragEnter(event)" ondragleave="dragLeave(event)">
                        <h3>In Progress</h3>
                        <div id="in-progress-tasks"></div>
                    </div>
                    <div class="kanban-column done" ondrop="drop(event, 'Done')" ondragover="allowDrop(event)" ondragenter="dragEnter(event)" ondragleave="dragLeave(event)">
                        <h3>Done</h3>
                        <div id="done-tasks"></div>
                    </div>
                </div>
            </div>
            <div id="project-management" class="tab-pane team-lead-only">
                <h2>Projects</h2>
                <button class="btn-primary" onclick="showProjectForm()" style="margin-bottom: 25px;">Create Project</button>
                <div id="projects-list"></div>
            </div>
            <div id="project-overview" class="tab-pane">
                <h2>Project Overview</h2>
                <div class="search-bar">
                    <input type="text" id="project-search" placeholder="Search by project name, category, or status" onkeyup="filterProjects()">
                </div>
                <table>
                    <thead>
                        <tr>
                            <th onclick="sortTable(0)">Project Name</th>
                            <th onclick="sortTable(1)">Assigned QA</th>
                            <th onclick="sortTable(2)">Project</th>
                            <th onclick="sortTable(3)">Category</th>
                            <th onclick="sortTable(4)">Subcategory</th>
                            <th onclick="sortTable(5)">Phase</th>
                            <th onclick="sortTable(6)">KT Received</th>
                            <th onclick="sortTable(7)">Start Date</th>
                            <th onclick="sortTable(8)">End Date</th>
                            <th onclick="sortTable(9)">Status</th>
                            <th onclick="sortTable(10)">Total Bugs</th>
                            <th onclick="sortTable(11)">High HTML Bugs</th>
                            <th onclick="sortTable(12)">Med HTML Bugs</th>
                            <th onclick="sortTable(13)">Low HTML Bugs</th>
                            <th onclick="sortTable(14)">High Func Bugs</th>
                            <th onclick="sortTable(15)">Med Func Bugs</th>
                            <th onclick="sortTable(16)">Low Func Bugs</th>
                            <th onclick="sortTable(17)">TL Verification</th>
                            <th onclick="sortTable(18)">Approval Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="project-overview-table"></tbody>
                </table>
            </div>
            <div id="approved-projects" class="tab-pane">
                <h2>Approved Projects</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Project Name</th>
                            <th>Assigned QA</th>
                            <th>Project</th>
                            <th>Category</th>
                            <th>Subcategory</th>
                            <th>Phase</th>
                            <th>KT Received</th>
                            <th>Start Date</th>
                            <th>End Date</th>
                            <th>Status</th>
                            <th>Total Bugs</th>
                            <th>High HTML Bugs</th>
                            <th>Med HTML Bugs</th>
                            <th>Low HTML Bugs</th>
                            <th>High Func Bugs</th>
                            <th>Med Func Bugs</th>
                            <th>Low Func Bugs</th>
                            <th>Approved Date</th>
                        </tr>
                    </thead>
                    <tbody id="approved-projects-table"></tbody>
                </table>
            </div>
            <div id="rejected-projects" class="tab-pane">
                <h2>Rejected Projects</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Project Name</th>
                            <th>Assigned QA</th>
                            <th>Project</th>
                            <th>Category</th>
                            <th>Subcategory</th>
                            <th>Phase</th>
                            <th>KT Received</th>
                            <th>Start Date</th>
                            <th>End Date</th>
                            <th>Status</th>
                            <th>Total Bugs</th>
                            <th>High HTML Bugs</th>
                            <th>Med HTML Bugs</th>
                            <th>Low HTML Bugs</th>
                            <th>High Func Bugs</th>
                            <th>Med Func Bugs</th>
                            <th>Low Func Bugs</th>
                            <th>Rejection Date</th>
                            <th>Rejection Reason</th>
                            <th>Rejected By</th>
                        </tr>
                    </thead>
                    <tbody id="rejected-projects-table"></tbody>
                </table>
            </div>
            <div id="project-types" class="tab-pane team-lead-admin">
                <h2>Project Types</h2>
                <button class="btn-primary" onclick="showCategoryForm()" style="margin-bottom: 25px;">Add Category</button>
                <div id="project-types-list"></div>
            </div>
            <div id="qa-report" class="tab-pane team-lead-admin">
                <h2>QA Report</h2>
                <div class="filters" style="display: flex; gap: 15px; margin-bottom: 25px;">
                    <input type="date" id="report-filter-date">
                    <select id="report-filter-qa"></select>
                    <select id="report-filter-project"></select>
                    <select id="report-filter-category" onchange="updateSubcategoryFilter()"></select>
                    <select id="report-filter-subcategory"></select>
                    <button class="btn-primary" onclick="renderReports()">Apply Filters</button>
                    <button class="btn-primary" onclick="exportReport()">Export Report</button>
                </div>
                <div id="reports-list"></div>
                <div id="bug-stats"></div>
            </div>
            <div id="activity-log" class="tab-pane team-lead-only">
                <h2>Activity Log</h2>
                <div id="activity-log-list"></div>
            </div>
            <div id="profile" class="tab-pane">
                <h2>Profile</h2>
                <form id="profile-form">
                    <div class="form-group">
                        <label for="profile-name" class="required">Your Name</label>
                        <input type="text" id="profile-name" placeholder="Enter your name" required>
                    </div>
                    <button type="submit" class="btn-primary">Update Profile</button>
                </form>
            </div>
            <div id="user-management" class="tab-pane team-lead-only">
                <h2>User Management</h2>
                <button class="btn-primary" onclick="showUserForm()" style="margin-bottom: 25px;">Add User</button>
                <div id="users-list"></div>
            </div>
            <div id="assign-roles" class="tab-pane team-lead-only">
                <h2>Assign Roles</h2>
                <div id="roles-list"></div>
            </div>
        </div>
    </div>
    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal()" tabindex="0">√ó</span>
            <h2 id="modal-title"></h2>
            <div id="modal-body"></div>
        </div>
    </div>
    <div id="login-modal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeLoginModal()" tabindex="0">√ó</span>
            <h2>Login</h2>
            <form id="login-form">
                <div class="form-group">
                    <label for="login-user-id" class="required">User ID</label>
                    <input type="text" id="login-user-id" placeholder="Enter User ID" required>
                </div>
                <button type="submit" class="btn-primary">Login</button>
            </form>
        </div>
    </div>

    <script>
        let state = {
            currentUser: null,
            users: [
                { id: 'TL01', name: 'Abhiram P Mohan', role: 'Team Lead', email: 'jane@example.com' },
                { id: 'u2', name: 'Abhiram', role: 'QA Member', email: 'abhiram@example.com' },
                { id: 'u3', name: 'Carol', role: 'Admin', email: 'carol@example.com' },
                { id: 'u4', name: 'Aswathi', role: 'QA Member', email: 'aswathi@example.com' },
                { id: 'u5', name: 'Minnu', role: 'QA Member', email: 'minnu@example.com' }
            ],
            tasks: [],
            projects: [],
            projectOverview: [],
            activityLog: [],
            standupEntries: [],
            testingPhases: ['HTML Comparison', 'HTML Comparison Retest', 'Dev Test', 'Dev Retest', 'Before Live', 'After Live'],
            projectCategories: [
                { name: 'General Project Categories', subcategories: ['HTML', 'Multilingual', 'Mobile App', 'Al Jazira'] },
                { name: 'WordPress Projects (CMS-based)', subcategories: ['WordPress', 'CMS_Word_Cust_10', 'CMS_Word_Cust_15', 'CMS_Word_Cust_25', 'CMS_Word_Cust_40', 'CMS_Word_Theme_X', 'Ecom Wordpress', 'CMS Advanced WP'] },
                { name: 'PHP Projects (CMS-based)', subcategories: ['CMS_Adv', 'CMS_PHP_Cust_10', 'CMS_PHP_Cust_15', 'CMS_PHP_Cust_25', 'CMS_PHP_Cust_40', 'Ecom PHP'] },
                { name: 'Custom PHP Development', subcategories: ['PHP'] }
            ],
            sortDirection: {}
        };

        function showLoginModal() {
            document.getElementById('login-modal').style.display = 'flex';
            document.getElementById('login-user-id').focus();
        }

        function closeLoginModal() {
            document.getElementById('login-modal').style.display = 'none';
        }

        function simulateLoginFromModal(e) {
            e.preventDefault();
            const userId = document.getElementById('login-user-id').value.trim();
            const user = state.users.find(u => u.id === userId);
            if (user) {
                state.currentUser = user;
                showNotification(`Logged in as ${user.name}`);
                closeLoginModal();
                updateUserAvatar();
                setupSidebar();
                switchTab('dashboard');
            } else {
                showNotification('Invalid User ID', null, true);
            }
        }

        function simulateLogin() {
            showLoginModal();
        }

        document.addEventListener('DOMContentLoaded', () => {
            populateProjects();
            populateProjectOverview();
            populateTasks();
            showLoginModal();
            document.getElementById('login-form').addEventListener('submit', simulateLoginFromModal);
            document.getElementById('standup-form').onsubmit = e => {
                e.preventDefault();
                submitStandup();
            };
            document.getElementById('profile-form').onsubmit = e => {
                e.preventDefault();
                updateProfile();
            };
            if (localStorage.getItem('theme') === 'light') {
                document.body.classList.add('light-mode');
                document.getElementById('theme-checkbox').checked = true;
            }
        });

        function setupSidebar() {
            const role = state.currentUser?.role || '';
            document.querySelectorAll('.sidebar-item').forEach(item => {
                const tabId = item.getAttribute('data-tab');
                if (role === 'QA Member') {
                    if (['project-management', 'project-types', 'qa-report', 'activity-log', 'user-management', 'assign-roles'].includes(tabId)) {
                        item.style.display = 'none';
                        return;
                    }
                }
                if (role === 'QA Member' && ['approved-projects', 'rejected-projects'].includes(tabId)) {
                    item.style.display = state.projectOverview.some(po => po.qaId === state.currentUser.id && po.tlVerification === 'Verified') ? 'block' : 'none';
                } else {
                    item.style.display = 'block';
                }

                item.addEventListener('click', () => {
                    console.log(`Clicked sidebar item: ${tabId}`);
                    switchTab(tabId);
                });
                item.setAttribute('tabindex', '0');
                item.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        console.log(`Keydown on sidebar item: ${tabId}`);
                        switchTab(tabId);
                    }
                });
            });
        }

        function switchTab(tabId) {
            console.log(`Switching to tab: ${tabId}`);
            document.querySelectorAll('.tab-pane').forEach(pane => pane.classList.remove('active'));
            document.querySelectorAll('.sidebar-item').forEach(item => item.classList.remove('active'));
            const pane = document.getElementById(tabId);
            const item = document.querySelector(`.sidebar-item[data-tab="${tabId}"]`);
            if (pane && item && isAuthorized(tabId)) {
                console.log(`Tab ${tabId} authorized and found`);
                pane.classList.add('active');
                item.classList.add('active');
                updateBreadcrumbs(tabId);
                loadTabData(tabId);
            } else {
                console.log(`Tab ${tabId} not authorized or not found`);
            }
        }

        function isAuthorized(tabId) {
            if (!state.currentUser) return false;
            const role = state.currentUser.role;
            if (role === 'Team Lead') return true;
            if (role === 'Admin' && document.getElementById(tabId).classList.contains('team-lead-admin')) return true;
            return !document.getElementById(tabId).classList.contains('team-lead-only') && !document.getElementById(tabId).classList.contains('team-lead-admin');
        }

        function updateBreadcrumbs(tabId) {
            const tabNames = {
                'dashboard': 'Dashboard',
                'daily-standup': 'Daily Standup',
                'kanban-board': 'Kanban Board',
                'project-management': 'Projects',
                'project-overview': 'Project Overview',
                'approved-projects': 'Approved Projects',
                'rejected-projects': 'Rejected Projects',
                'project-types': 'Project Types',
                'qa-report': 'QA Report',
                'activity-log': 'Activity Log',
                'profile': 'Profile',
                'user-management': 'User Management',
                'assign-roles': 'Assign Roles'
            };
            document.getElementById('breadcrumbs').innerHTML = `<a href="#" onclick="switchTab('dashboard')">Dashboard</a> > ${tabNames[tabId]}`;
        }

        function loadTabData(tabId) {
            showLoading();
            setTimeout(() => {
                const loaders = {
                    'dashboard': renderDashboard,
                    'daily-standup': renderStandup,
                    'kanban-board': renderKanban,
                    'project-management': renderProjects,
                    'project-overview': renderProjectOverview,
                    'approved-projects': renderApprovedProjects,
                    'rejected-projects': renderRejectedProjects,
                    'project-types': renderProjectTypes,
                    'qa-report': renderReports,
                    'activity-log': renderActivityLog,
                    'profile': renderProfile,
                    'user-management': renderUsers,
                    'assign-roles': renderAssignRoles
                };
                loaders[tabId]?.();
                hideLoading();
            }, 500);
        }

        function showNotification(message, userId = null, isError = false) {
            if (!userId || userId === state.currentUser?.id) {
                const notification = document.getElementById('notification');
                notification.textContent = message;
                notification.classList.toggle('error-notification', isError);
                notification.style.display = 'block';
                setTimeout(() => notification.style.display = 'none', 3000);
            }
            if (state.currentUser) {
                state.activityLog.push({ action: `Notified: ${message}`, user: state.currentUser.name, timestamp: Date.now() });
            }
        }

        function showModal(title, content) {
            document.getElementById('modal-title').textContent = title;
            document.getElementById('modal-body').innerHTML = content;
            document.getElementById('modal').style.display = 'flex';
            document.querySelector('.modal-close').focus();
        }

        function closeModal() {
            document.getElementById('modal').style.display = 'none';
        }

        function showLoading() {
            document.getElementById('loader').style.display = 'flex';
        }

        function hideLoading() {
            document.getElementById('loader').style.display = 'none';
        }

        function loadInitialData() {
            if (state.currentUser) {
                document.getElementById('user-name').textContent = `Welcome ${state.currentUser.name}`;
                document.getElementById('welcome-user').textContent = state.currentUser.name;
                const qaFilter = document.getElementById('report-filter-qa');
                qaFilter.innerHTML = `<option value="">Filter by QA</option>` + state.users.map(u => `<option value="${u.id}">${u.name}</option>`).join('');
                const projectFilter = document.getElementById('report-filter-project');
                projectFilter.innerHTML = `<option value="">Filter by Project</option>` + state.projects.map(p => `<option value="${p.id}">${p.name}</option>`).join('');
                const categoryFilter = document.getElementById('report-filter-category');
                categoryFilter.innerHTML = `<option value="">Filter by Category</option>` + state.projectCategories.map(cat => `<option value="${cat.name}">${cat.name}</option>`).join('');
                updateSubcategoryFilter();
            }
        }

        function updateSubcategoryFilter() {
            const categoryFilter = document.getElementById('report-filter-category').value;
            const subcategoryFilter = document.getElementById('report-filter-subcategory');
            if (categoryFilter) {
                const category = state.projectCategories.find(cat => cat.name === categoryFilter);
                subcategoryFilter.innerHTML = `<option value="">Filter by Subcategory</option>` + category.subcategories.map(sub => `<option value="${sub}">${sub}</option>`).join('');
            } else {
                subcategoryFilter.innerHTML = `<option value="">Filter by Subcategory</option>`;
            }
        }

        function renderDashboardForTL() {
            const stats = calculateDashboardStats();
            const projectsByCategory = state.projectCategories.map(category => {
                const categoryStats = stats[category.name] || { projects: 0, pendingApprovals: 0, completedProjects: 0 };
                return `
                    <div class="widget">
                        <h3>${category.name}</h3>
                        ${categoryStats.projects === 0 ? `
                            <p>No projects yet‚Äîcreate one now!</p>
                        ` : `
                            <div class="stats">
                                <span class="stats-number">${categoryStats.projects}</span>
                                <span>Projects</span>
                            </div>
                            <div class="stats-list">
                                <div class="stats-list-item">Pending Approvals: ${categoryStats.pendingApprovals}</div>
                                <div class="stats-list-item">Completed Projects: ${categoryStats.completedProjects}</div>
                            </div>
                        `}
                    </div>
                `;
            }).join('');

            const pendingVerifications = state.projectOverview.filter(po => po.tlVerification === 'Pending');
            const verificationSection = `
                <div class="widget">
                    <h3>Projects Pending TL Verification</h3>
                    ${pendingVerifications.length ? pendingVerifications.map(po => `
                        <div class="list-item">
                            <span>${po.projectName} (QA: ${state.users.find(u => u.id === po.qaId)?.name || 'Unknown'})</span>
                            <div>
                                <button class="btn-primary" onclick="verifyProject('${po.id}', true)">Verify</button>
                                <button class="btn-danger" onclick="verifyProject('${po.id}', false)">Not Verified</button>
                            </div>
                        </div>
                    `).join('') : '<p>No projects pending verification.</p>'}
                </div>
            `;

            document.getElementById('dashboard-content').innerHTML = projectsByCategory + verificationSection;
        }

        function renderDashboardForMember() {
            const assignedProjects = state.projectOverview.filter(po => po.qaId === state.currentUser.id);
            const projectsSummary = assignedProjects.map(po => `
                <div class="widget">
                    <h3>${po.projectName}</h3>
                    <div class="stats-list">
                        <div class="stats-list-item">Category: ${po.projectCategory}</div>
                        <div class="stats-list-item">Subcategory: ${po.projectSubcategory}</div>
                        <div class="stats-list-item">Phase: ${po.currentPhase}</div>
                        <div class="stats-list-item">Status: ${po.status}</div>
                        <div class="stats-list-item">Total Bugs: ${po.totalBugs}</div>
                        <div class="stats-list-item">TL Verification: ${po.tlVerification || 'Not Requested'}</div>
                    </div>
                </div>
            `).join('');

            document.getElementById('dashboard-content').innerHTML = projectsSummary || `
                <div class="widget">
                    <h3>No Assigned Projects</h3>
                    <p>You currently have no projects assigned.</p>
                </div>
            `;
        }

        function renderDashboard() {
            if (!state.currentUser) return;
            if (state.currentUser.role === 'Team Lead') {
                renderDashboardForTL();
            } else {
                renderDashboardForMember();
            }
        }

        function renderStandup() {}

        function submitStandup() {
            const yesterday = document.getElementById('standup-yesterday').value.trim();
            const today = document.getElementById('standup-today').value.trim();
            if (!yesterday || !today) {
                showNotification('Please fill in all required fields', null, true);
                return;
            }
            const entry = {
                yesterday,
                today,
                blockers: document.getElementById('standup-blockers').value.trim(),
                user: state.currentUser.name,
                date: new Date().toISOString()
            };
            state.standupEntries.push(entry);
            state.activityLog.push({ action: 'Submitted standup', user: state.currentUser.name, timestamp: Date.now() });
            showNotification('Standup submitted successfully');
            document.getElementById('standup-form').reset();
        }

        function renderKanban() {
            const columns = ['to-do', 'in-progress', 'done'];
            columns.forEach(col => {
                const status = col.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase());
                let tasks = state.tasks.filter(t => t.status === status);
                if (state.currentUser.role !== 'Team Lead') {
                    tasks = tasks.filter(t => t.assignedTo === state.currentUser.id);
                }
                const taskHtml = tasks.length ? tasks.map(t => `
                    <div style="background: #34495e; padding: 14px; margin-bottom: 10px; border-radius: 4px; cursor: move; box-shadow: var(--shadow); color: var(--text-color); font-size: 16px;" draggable="true" ondragstart="drag(event, '${t.id}')">
                        ${t.name} (Assigned to: ${state.users.find(u => u.id === t.assignedTo)?.name || 'Unassigned'})
                    </div>
                `).join('') : `<p>No tasks yet‚Äîclick 'Add Task' to get started!</p>`;
                document.getElementById(`${col}-tasks`).innerHTML = taskHtml;
            });
        }

        function allowDrop(ev) {
            ev.preventDefault();
        }

        function dragEnter(ev) {
            ev.target.closest('.kanban-column').classList.add('dragover');
        }

        function dragLeave(ev) {
            ev.target.closest('.kanban-column').classList.remove('dragover');
        }

        function drag(ev, taskId) {
            ev.dataTransfer.setData('text', taskId);
        }

        function drop(ev, status) {
            ev.preventDefault();
            const taskId = ev.dataTransfer.getData('text');
            const task = state.tasks.find(t => t.id === taskId);
            if (task) {
                const previousStatus = task.status;
                task.status = status;
                state.activityLog.push({ action: `Moved task to ${status}`, user: state.currentUser.name, timestamp: Date.now() });
                renderKanban();
                showNotification(`Task moved to ${status}`, task.assignedTo);

                if (previousStatus === 'To Do' && status === 'In Progress') {
                    const project = state.projects.find(p => p.id === task.projectId);
                    if (project) {
                        const existingEntry = state.projectOverview.find(po => po.projectId === task.projectId && po.currentPhase === task.phase);
                        if (!existingEntry) {
                            state.projectOverview.push({
                                id: `po${Date.now()}`,
                                projectId: task.projectId,
                                projectName: project.name,
                                qaId: task.assignedTo,
                                projectCategory: project.projectCategory || '',
                                projectSubcategory: project.projectSubcategory || '',
                                currentPhase: task.phase,
                                ktReceived: '',
                                startDate: '',
                                endDate: '',
                                status: 'In Progress',
                                totalBugs: 0,
                                highPriorityHtmlBugs: 0,
                                mediumPriorityHtmlBugs: 0,
                                lowPriorityHtmlBugs: 0,
                                highPriorityFunctionalBugs: 0,
                                mediumPriorityFunctionalBugs: 0,
                                lowPriorityFunctionalBugs: 0,
                                tlVerification: 'Not Requested',
                                approvalStatus: 'Not Set',
                                approvedDate: '',
                                rejectionDate: '',
                                rejectionReason: '',
                                rejectedBy: ''
                            });
                            renderProjectOverview();
                            renderDashboard();
                        }
                    }
                }
            }
            ev.target.closest('.kanban-column').classList.remove('dragover');
        }

        function showTaskForm() {
            if (state.currentUser.role !== 'Team Lead') return showNotification('Only Team Lead can add tasks');
            const content = `
                <form id="task-form">
                    <div class="form-group">
                        <label for="task-name" class="required">Task Name</label>
                        <input type="text" id="task-name" placeholder="Enter task name" required>
                    </div>
                    <div class="form-group">
                        <label for="task-project" class="required">Project</label>
                        <select id="task-project" required>
                            <option value="">Select Project</option>
                            ${state.projects.map(p => `<option value="${p.id}">${p.name}</option>`).join('')}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="task-phase" class="required">Phase</label>
                        <select id="task-phase" required>
                            <option value="">Select Phase</option>
                            ${state.testingPhases.map(phase => `<option value="${phase}">${phase}</option>`).join('')}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="task-assigned" class="required">Assignee</label>
                        <select id="task-assigned" required>
                            <option value="">Select Assignee</option>
                            ${state.users.map(u => `<option value="${u.id}">${u.name} (${u.role})</option>`).join('')}
                        </select>
                    </div>
                    <button type="submit" class="btn-primary">Add Task</button>
                </form>
            `;
            showModal('Add Task', content);
            document.getElementById('task-form').addEventListener('submit', (e) => {
                e.preventDefault();
                addTask();
            });
        }

        function addTask() {
            const projectId = document.getElementById('task-project').value;
            const project = state.projects.find(p => p.id === projectId);
            if (!project) return showNotification('Please select a valid project', null, true);

            const taskName = document.getElementById('task-name').value.trim();
            const phase = document.getElementById('task-phase').value;
            const assignedTo = document.getElementById('task-assigned').value;
            if (!taskName || !phase || !assignedTo) return showNotification('All fields are required', null, true);

            const task = {
                id: `t${Date.now()}`,
                name: taskName,
                projectId: projectId,
                phase: phase,
                assignedTo: assignedTo,
                status: 'To Do'
            };
            state.tasks.push(task);
            state.activityLog.push({ action: `Added new task: ${task.name}`, user: state.currentUser.name, timestamp: Date.now() });
            renderKanban();
            closeModal();
            showNotification(`Task "${task.name}" assigned to ${state.users.find(u => u.id === task.assignedTo)?.name}`, task.assignedTo);
        }

        function renderProjects() {
            document.getElementById('projects-list').innerHTML = state.projects.map(p => `
                <div class="list-item">
                    <span>${p.name} - ${p.status} (Category: ${p.projectCategory || 'N/A'}, Subcategory: ${p.projectSubcategory || 'N/A'})</span>
                </div>
            `).join('');
        }

        function showProjectForm() {
            if (state.currentUser.role !== 'Team Lead') return showNotification('Only Team Lead can create projects');
            const content = `
                <form id="project-form">
                   egister                    <div class="form-group">
                        <label for="project-name" class="required">Project Name</label>
                        <input type="text" id="project-name" placeholder="e.g., Website Redesign" required>
                    </div>
                    <div class="form-group">
                        <label for="bug-tracker-link" class="required">Bug Tracker Link (GitLab)</label>
                        <input type="text" id="bug-tracker-link" placeholder="e.g., https://gitlab.com/project" required>
                    </div>
                    <div class="form-group">
                        <label for="project-category" class="required">Category</label>
                        <select id="project-category" required onchange="updateProjectSubcategoryOptions()">
                            <option value="">Choose a category</option>
                            ${state.projectCategories.map(cat => `<option value="${cat.name}">${cat.name}</option>`).join('')}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="project-subcategory" class="required">Subcategory</label>
                        <select id="project-subcategory" required>
                            <option value="">Select Subcategory</option>
                        </select>
                    </div>
                    <button type="submit" class="btn-primary">Create Project</button>
                </form>
            `;
            showModal('Create Project', content);
            document.getElementById('project-form').addEventListener('submit', (e) => {
                e.preventDefault();
                createProject();
            });
        }

        function updateProjectSubcategoryOptions() {
            const category = document.getElementById('project-category').value;
            const subcategorySelect = document.getElementById('project-subcategory');
            if (category) {
                const subcategories = state.projectCategories.find(cat => cat.name === category).subcategories;
                subcategorySelect.innerHTML = `<option value="">Select Subcategory</option>` + subcategories.map(sub => `<option value="${sub}">${sub}</option>`).join('');
            } else {
                subcategorySelect.innerHTML = `<option value="">Select Subcategory</option>`;
            }
        }

        function createProject() {
            const name = document.getElementById('project-name').value.trim();
            const bugTrackerLink = document.getElementById('bug-tracker-link').value.trim();
            const category = document.getElementById('project-category').value;
            const subcategory = document.getElementById('project-subcategory').value;
            if (!name || !bugTrackerLink || !category || !subcategory) {
                showNotification('All fields are required', null, true);
                return;
            }

            const project = {
                id: `p${Date.now()}`,
                name,
                bugTrackerLink,
                status: 'In Progress',
                projectCategory: category,
                projectSubcategory: subcategory
            };
            state.projects.push(project);
            state.activityLog.push({ action: `Created project ${project.name}`, user: state.currentUser.name, timestamp: Date.now() });
            renderProjects();
            closeModal();
            showNotification('Project created');
            const projectFilter = document.getElementById('report-filter-project');
            projectFilter.innerHTML = `<option value="">Filter by Project</option>` + state.projects.map(p => `<option value="${p.id}">${p.name}</option>`).join('');
        }

        function renderProjectTypes() {
            if (state.currentUser.role !== 'Team Lead' && state.currentUser.role !== 'Admin') return showNotification('Only Team Lead or Admin can manage project types');
            const projectTypesList = document.getElementById('project-types-list');
            projectTypesList.innerHTML = state.projectCategories.map((category, index) => `
                <div class="category-item">
                    <span>${category.name}</span>
                    <div>
                        <button class="btn-primary" onclick="showSubcategoryForm(${index})" title="Add Subcategory">Add Subcategory</button>
                        <button class="btn-danger" onclick="deleteCategory(${index})" title="Delete Category">Delete</button>
                    </div>
                </div>
                <div class="subcategory-list">
                    ${category.subcategories.map((sub, subIndex) => `
                        <div class="subcategory-item">
                            <span>${sub}</span>
                            <button class="btn-danger" onclick="deleteSubcategory(${index}, ${subIndex})" title="Delete Subcategory">Delete</button>
                        </div>
                    `).join('')}
                </div>
            `).join('');
        }

        function showCategoryForm() {
            const content = `
                <form id="category-form">
                    <div class="form-group">
                        <label for="category-name" class="required">Category Name</label>
                        <input type="text" id="category-name" placeholder="e.g., New Category" required>
                    </div>
                    <button type="submit" class="btn-primary">Add Category</button>
                </form>
            `;
            showModal('Add Category', content);
            document.getElementById('category-form').addEventListener('submit', (e) => {
                e.preventDefault();
                addCategory();
            });
        }

        function addCategory() {
            const categoryName = document.getElementById('category-name').value.trim();
            if (!categoryName) return showNotification('Category name cannot be empty', null, true);
            if (state.projectCategories.some(cat => cat.name === categoryName)) return showNotification('Category already exists', null, true);

            state.projectCategories.push({ name: categoryName, subcategories: [] });
            state.activityLog.push({ action: `Added category ${categoryName}`, user: state.currentUser.name, timestamp: Date.now() });
            renderProjectTypes();
            closeModal();
            showNotification('Category added');
            updateCategoryFilters();
        }

        function deleteCategory(index) {
            const category = state.projectCategories[index];
            if (state.projects.some(p => p.projectCategory === category.name)) {
                return showNotification('Cannot delete category with associated projects', null, true);
            }
            state.projectCategories.splice(index, 1);
            state.activityLog.push({ action: `Deleted category ${category.name}`, user: state.currentUser.name, timestamp: Date.now() });
            renderProjectTypes();
            showNotification('Category deleted');
            updateCategoryFilters();
        }

        function showSubcategoryForm(categoryIndex) {
            const category = state.projectCategories[categoryIndex];
            const content = `
                <form id="subcategory-form">
                    <div class="form-group">
                        <label for="subcategory-name" class="required">Subcategory Name</label>
                        <input type="text" id="subcategory-name" placeholder="e.g., New Subcategory" required>
                    </div>
                    <button type="submit" class="btn-primary">Add Subcategory</button>
                </form>
            `;
            showModal(`Add Subcategory to ${category.name}`, content);
            document.getElementById('subcategory-form').addEventListener('submit', (e) => {
                e.preventDefault();
                addSubcategory(categoryIndex);
            });
        }

        function addSubcategory(categoryIndex) {
            const subcategoryName = document.getElementById('subcategory-name').value.trim();
            if (!subcategoryName) return showNotification('Subcategory name cannot be empty', null, true);
            const category = state.projectCategories[categoryIndex];
            if (category.subcategories.includes(subcategoryName)) return showNotification('Subcategory already exists in this category', null, true);

            category.subcategories.push(subcategoryName);
            state.activityLog.push({ action: `Added subcategory ${subcategoryName} to ${category.name}`, user: state.currentUser.name, timestamp: Date.now() });
            renderProjectTypes();
            closeModal();
            showNotification('Subcategory added');
            updateCategoryFilters();
        }

        function deleteSubcategory(categoryIndex, subcategoryIndex) {
            const category = state.projectCategories[categoryIndex];
            const subcategory = category.subcategories[subcategoryIndex];
            if (state.projects.some(p => p.projectCategory === category.name && p.projectSubcategory === subcategory)) {
                return showNotification('Cannot delete subcategory with associated projects', null, true);
            }
            category.subcategories.splice(subcategoryIndex, 1);
            state.activityLog.push({ action: `Deleted subcategory ${subcategory} from ${category.name}`, user: state.currentUser.name, timestamp: Date.now() });
            renderProjectTypes();
            showNotification('Subcategory deleted');
            updateCategoryFilters();
        }

        function updateCategoryFilters() {
            const categoryFilter = document.getElementById('report-filter-category');
            categoryFilter.innerHTML = `<option value="">Filter by Category</option>` + state.projectCategories.map(cat => `<option value="${cat.name}">${cat.name}</option>`).join('');
            updateSubcategoryFilter();
        }

        function renderProjectOverview() {
            const tbody = document.getElementById('project-overview-table');
            const isTeamLead = state.currentUser.role === 'Team Lead';
            const isQAMember = state.currentUser.role === 'QA Member';

            let projectsToShow = state.projectOverview;
            if (isQAMember) {
                projectsToShow = state.projectOverview.filter(po => po.qaId === state.currentUser.id);
            }

            tbody.innerHTML = projectsToShow.map(po => {
                const project = state.projects.find(p => p.id === po.projectId);
                const isVerified = po.tlVerification === 'Verified';
                const isPendingVerification = po.tlVerification === 'Pending';
                const isNotVerified = po.tlVerification === 'Not Verified';

                return `
                    <tr>
                        <td>${po.projectName}</td>
                        <td>
                            <select ${isTeamLead ? '' : 'disabled'} onchange="updateProjectOverview('${po.id}', 'qaId', this.value)">
                                <option value="">Select QA</option>
                                ${state.users.map(u => `<option value="${u.id}" ${u.id === po.qaId ? 'selected' : ''}>${u.name}</option>`).join('')}
                            </select>
                        </td>
                        <td>
                            <select ${isTeamLead ? '' : 'disabled'} onchange="updateProjectOverview('${po.id}', 'projectId', this.value)">
                                <option value="">Select Project</option>
                                ${state.projects.map(p => `<option value="${p.id}" ${p.id === po.projectId ? 'selected' : ''}>${p.name}</option>`).join('')}
                            </select>
                        </td>
                        <td>
                            <select ${isTeamLead ? '' : 'disabled'} onchange="updateProjectOverview('${po.id}', 'projectCategory', this.value); updateSubcategoryOptions('${po.id}', this.value)">
                                <option value="">Select Category</option>
                                ${state.projectCategories.map(cat => `<option value="${cat.name}" ${cat.name === po.projectCategory ? 'selected' : ''}>${cat.name}</option>`).join('')}
                            </select>
                        </td>
                        <td>
                            <select id="subcategory-${po.id}" ${isTeamLead ? '' : 'disabled'} onchange="updateProjectOverview('${po.id}', 'projectSubcategory', this.value)">
                                <option value="">Select Subcategory</option>
                                ${po.projectCategory ? state.projectCategories.find(cat => cat.name === po.projectCategory).subcategories.map(sub => `<option value="${sub}" ${sub === po.projectSubcategory ? 'selected' : ''}>${sub}</option>`).join('') : ''}
                            </select>
                        </td>
                        <td>
                            <select onchange="updateProjectOverview('${po.id}', 'currentPhase', this.value)">
                                <option value="">Select Phase</option>
                                ${state.testingPhases.map(phase => `<option value="${phase}" ${phase === po.currentPhase ? 'selected' : ''}>${phase}</option>`).join('')}
                            </select>
                        </td>
                        <td>
                            <select onchange="updateProjectOverview('${po.id}', 'ktReceived', this.value)">
                                <option value="">Select</option>
                                <option value="Yes" ${po.ktReceived === 'Yes' ? 'selected' : ''}>Yes</option>
                                <option value="No" ${po.ktReceived === 'No' ? 'selected' : ''}>No</option>
                            </select>
                        </td>
                        <td><input type="date" value="${po.startDate}" onchange="updateProjectOverview('${po.id}', 'startDate', this.value)"></td>
                        <td><input type="date" value="${po.endDate}" onchange="updateProjectOverview('${po.id}', 'endDate', this.value)"></td>
                        <td>
                            <select onchange="updateProjectOverview('${po.id}', 'status', this.value)">
                                <option value="In Progress" ${po.status === 'In Progress' ? 'selected' : ''}>In Progress</option>
                                <option value="Pending" ${po.status === 'Pending' ? 'selected' : ''}>Pending</option>
                            </select>
                        </td>
                        <td>${po.totalBugs}</td>
                        <td class="bug-high"><input type="number" value="${po.highPriorityHtmlBugs || 0}" onchange="updateProjectOverview('${po.id}', 'highPriorityHtmlBugs', this.value)"></td>
                        <td class="bug-medium"><input type="number" value="${po.mediumPriorityHtmlBugs || 0}" onchange="updateProjectOverview('${po.id}', 'mediumPriorityHtmlBugs', this.value)"></td>
                        <td class="bug-low"><input type="number" value="${po.lowPriorityHtmlBugs || 0}" onchange="updateProjectOverview('${po.id}', 'lowPriorityHtmlBugs', this.value)"></td>
                        <td class="bug-high"><input type="number" value="${po.highPriorityFunctionalBugs || 0}" onchange="updateProjectOverview('${po.id}', 'highPriorityFunctionalBugs', this.value)"></td>
                        <td class="bug-medium"><input type="number" value="${po.mediumPriorityFunctionalBugs || 0}" onchange="updateProjectOverview('${po.id}', 'mediumPriorityFunctionalBugs', this.value)"></td>
                        <td class="bug-low"><input type="number" value="${po.lowPriorityFunctionalBugs || 0}" onchange="updateProjectOverview('${po.id}', 'lowPriorityFunctionalBugs', this.value)"></td>
                        <td>
                            ${isTeamLead ? (po.tlVerification === 'Pending' ? `
                                <button class="btn-primary" onclick="verifyProject('${po.id}', true)">Verify</button>
                                <button class="btn-danger" onclick="verifyProject('${po.id}', false)">Not Verified</button>
                            ` : po.tlVerification || 'Not Requested') : (isPendingVerification ? 'Pending Verification' : (isNotVerified ? `
                                <button class="btn-primary" onclick="requestVerification('${po.id}')">Resubmit for Verification</button>
                            ` : (po.tlVerification === 'Not Requested' ? `
                                <button class="btn-primary" onclick="requestVerification('${po.id}')">Request Verification</button>
                            ` : 'Verified by TL')))}
                        </td>
                        <td>
                            ${isTeamLead || (isQAMember && isVerified) ? `
                                <select onchange="updateApprovalStatus('${po.id}', this.value)">
                                    <option value="Not Set" ${po.approvalStatus === 'Not Set' ? 'selected' : ''}>Not Set</option>
                                    <option value="Approved" ${po.approvalStatus === 'Approved' ? 'selected' : ''}>Approved</option>
                                    <option value="Rejected" ${po.approvalStatus === 'Rejected' ? 'selected' : ''}>Rejected</option>
                                </select>
                            ` : 'N/A'}
                        </td>
                        <td>
                            ${isNotVerified ? `
                                <button class="btn-primary" onclick="updateBugList('${po.id}')">Update Bug List</button>
                            ` : ''}
                        </td>
                    </tr>
                `;
            }).join('');
            filterProjects();
        }

        function updateSubcategoryOptions(projectId, category) {
            const subcategorySelect = document.getElementById(`subcategory-${projectId}`);
            if (category) {
                const subcategories = state.projectCategories.find(cat => cat.name === category).subcategories;
                subcategorySelect.innerHTML = `<option value="">Select Subcategory</option>` + subcategories.map(sub => `<option value="${sub}">${sub}</option>`).join('');
            } else {
                subcategorySelect.innerHTML = `<option value="">Select Subcategory</option>`;
            }
        }

        function updateProjectOverview(id, field, value) {
            const entry = state.projectOverview.find(po => po.id === id);
            if (entry) {
                entry[field] = field.includes('Bugs') ? parseInt(value) || 0 : value;
                if (field.includes('Bugs')) {
                    entry.totalBugs = (entry.highPriorityHtmlBugs || 0) + (entry.mediumPriorityHtmlBugs || 0) + (entry.lowPriorityHtmlBugs || 0) +
                                     (entry.highPriorityFunctionalBugs || 0) + (entry.mediumPriorityFunctionalBugs || 0) + (entry.lowPriorityFunctionalBugs || 0);
                }
                state.activityLog.push({ action: `Updated project overview (${field})`, user: state.currentUser.name, timestamp: Date.now() });
                renderProjectOverview();
                renderDashboard();
            }
        }

        function requestVerification(projectOverviewId) {
            const entry = state.projectOverview.find(po => po.id === projectOverviewId);
            if (entry) {
                entry.tlVerification = 'Pending';
                state.activityLog.push({ action: `Requested TL verification for project ${entry.projectName}`, user: state.currentUser.name, timestamp: Date.now() });
                showNotification('Verification request sent to Team Lead', state.users.find(u => u.role === 'Team Lead')?.id);
                renderProjectOverview();
                renderDashboard();
            }
        }

        function verifyProject(projectOverviewId, isVerified) {
            const entry = state.projectOverview.find(po => po.id === projectOverviewId);
            if (entry) {
                entry.tlVerification = isVerified ? 'Verified' : 'Not Verified';
                if (!isVerified) {
                    const rejectionReason = prompt('Please provide a reason for not verifying:', '');
                    if (rejectionReason !== null) {
                        entry.rejectionReason = rejectionReason;
                    }
                }
                state.activityLog.push({ 
                    action: `Project ${entry.projectName} ${isVerified ? 'verified' : 'not verified'}`, 
                    user: state.currentUser.name, 
                    timestamp: Date.now() 
                });
                showNotification(`Project ${isVerified ? 'verified' : 'marked as not verified'}`, entry.qaId);
                renderProjectOverview();
                renderDashboard();
            }
        }

        function updateApprovalStatus(projectOverviewId, status) {
            const entry = state.projectOverview.find(po => po.id === projectOverviewId);
            if (entry) {
                entry.approvalStatus = status;
                if (status === 'Approved') {
                    entry.approvedDate = new Date().toISOString().split('T')[0];
                    state.activityLog.push({ 
                        action: `Approved project ${entry.projectName}`, 
                        user: state.currentUser.name, 
                        timestamp: Date.now() 
                    });
                } else if (status === 'Rejected') {
                    entry.rejectionDate = new Date().toISOString().split('T')[0];
                    entry.rejectedBy = state.currentUser.name;
                    const reason = prompt('Please provide a reason for rejection:', '');
                    if (reason !== null) {
                        entry.rejectionReason = reason;
                        state.activityLog.push({ 
                            action: `Rejected project ${entry.projectName} - Reason: ${reason}`, 
                            user: state.currentUser.name, 
                            timestamp: Date.now() 
                        });
                    }
                } else {
                    entry.approvedDate = '';
                    entry.rejectionDate = '';
                    entry.rejectionReason = '';
                    entry.rejectedBy = '';
                }
                showNotification(`Project approval status updated to ${status}`, entry.qaId);
                renderProjectOverview();
                renderApprovedProjects();
                renderRejectedProjects();
                setupSidebar(); // Update sidebar visibility for QA Members
            }
        }

        function updateBugList(projectOverviewId) {
            const entry = state.projectOverview.find(po => po.id === projectOverviewId);
            if (entry) {
                const content = `
                    <form id="bug-update-form">
                        <div class="form-group">
                            <label for="high-html-bugs">High Priority HTML Bugs</label>
                            <input type="number" id="high-html-bugs" value="${entry.highPriorityHtmlBugs || 0}" min="0">
                        </div>
                        <div class="form-group">
                            <label for="med-html-bugs">Medium Priority HTML Bugs</label>
                            <input type="number" id="med-html-bugs" value="${entry.mediumPriorityHtmlBugs || 0}" min="0">
                        </div>
                        <div class="form-group">
                            <label for="low-html-bugs">Low Priority HTML Bugs</label>
                            <input type="number" id="low-html-bugs" value="${entry.lowPriorityHtmlBugs || 0}" min="0">
                        </div>
                        <div class="form-group">
                            <label for="high-func-bugs">High Priority Functional Bugs</label>
                            <input type="number" id="high-func-bugs" value="${entry.highPriorityFunctionalBugs || 0}" min="0">
                        </div>
                        <div class="form-group">
                            <label for="med-func-bugs">Medium Priority Functional Bugs</label>
                            <input type="number" id="med-func-bugs" value="${entry.mediumPriorityFunctionalBugs || 0}" min="0">
                        </div>
                        <div class="form-group">
                            <label for="low-func-bugs">Low Priority Functional Bugs</label>
                            <input type="number" id="low-func-bugs" value="${entry.lowPriorityFunctionalBugs || 0}" min="0">
                        </div>
                        <button type="submit" class="btn-primary">Update Bugs</button>
                    </form>
                `;
                showModal(`Update Bug List for ${entry.projectName}`, content);
                document.getElementById('bug-update-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    const updatedBugs = {
                        highPriorityHtmlBugs: parseInt(document.getElementById('high-html-bugs').value) || 0,
                        mediumPriorityHtmlBugs: parseInt(document.getElementById('med-html-bugs').value) || 0,
                        lowPriorityHtmlBugs: parseInt(document.getElementById('low-html-bugs').value) || 0,
                        highPriorityFunctionalBugs: parseInt(document.getElementById('high-func-bugs').value) || 0,
                        mediumPriorityFunctionalBugs: parseInt(document.getElementById('med-func-bugs').value) || 0,
                        lowPriorityFunctionalBugs: parseInt(document.getElementById('low-func-bugs').value) || 0
                    };
                    entry.highPriorityHtmlBugs = updatedBugs.highPriorityHtmlBugs;
                    entry.mediumPriorityHtmlBugs = updatedBugs.mediumPriorityHtmlBugs;
                    entry.lowPriorityHtmlBugs = updatedBugs.lowPriorityHtmlBugs;
                    entry.highPriorityFunctionalBugs = updatedBugs.highPriorityFunctionalBugs;
                    entry.mediumPriorityFunctionalBugs = updatedBugs.mediumPriorityFunctionalBugs;
                    entry.lowPriorityFunctionalBugs = updatedBugs.lowPriorityFunctionalBugs;
                    entry.totalBugs = Object.values(updatedBugs).reduce((sum, val) => sum + val, 0);
                    state.activityLog.push({ 
                        action: `Updated bug list for ${entry.projectName}`, 
                        user: state.currentUser.name, 
                        timestamp: Date.now() 
                    });
                    closeModal();
                    renderProjectOverview();
                    showNotification('Bug list updated');
                });
            }
        }

        function filterProjects() {
            const search = document.getElementById('project-search').value.toLowerCase();
            const rows = document.querySelectorAll('#project-overview-table tr');
            rows.forEach(row => {
                const text = Array.from(row.cells).map(cell => cell.textContent.toLowerCase()).join(' ');
                row.style.display = text.includes(search) ? '' : 'none';
            });
        }

        function sortTable(columnIndex) {
            const tbody = document.getElementById('project-overview-table');
            const rows = Array.from(tbody.querySelectorAll('tr'));
            const isNumeric = [10, 11, 12, 13, 14, 15, 16].includes(columnIndex);
            const direction = state.sortDirection[columnIndex] === 'asc' ? 'desc' : 'asc';
            state.sortDirection[columnIndex] = direction;

            rows.sort((a, b) => {
                let aValue = a.cells[columnIndex].textContent.trim();
                let bValue = b.cells[columnIndex].textContent.trim();
                if (isNumeric) {
                    aValue = parseInt(aValue) || 0;
                    bValue = parseInt(bValue) || 0;
                    return direction === 'asc' ? aValue - bValue : bValue - aValue;
                }
                return direction === 'asc' ? aValue.localeCompare(bValue) : bValue.localeCompare(aValue);
            });

            rows.forEach(row => tbody.appendChild(row));
        }

        function renderApprovedProjects() {
            const tbody = document.getElementById('approved-projects-table');
            const approvedProjects = state.projectOverview.filter(po => po.approvalStatus === 'Approved');
            tbody.innerHTML = approvedProjects.map(po => `
                <tr>
                    <td>${po.projectName}</td>
                    <td>${state.users.find(u => u.id === po.qaId)?.name || 'Unassigned'}</td>
                    <td>${state.projects.find(p => p.id === po.projectId)?.name || 'N/A'}</td>
                    <td>${po.projectCategory}</td>
                    <td>${po.projectSubcategory}</td>
                    <td>${po.currentPhase}</td>
                    <td>${po.ktReceived}</td>
                    <td>${po.startDate}</td>
                    <td>${po.endDate}</td>
                    <td>${po.status}</td>
                    <td>${po.totalBugs}</td>
                    <td class="bug-high">${po.highPriorityHtmlBugs || 0}</td>
                    <td class="bug-medium">${po.mediumPriorityHtmlBugs || 0}</td>
                    <td class="bug-low">${po.lowPriorityHtmlBugs || 0}</td>
                    <td class="bug-high">${po.highPriorityFunctionalBugs || 0}</td>
                    <td class="bug-medium">${po.mediumPriorityFunctionalBugs || 0}</td>
                    <td class="bug-low">${po.lowPriorityFunctionalBugs || 0}</td>
                    <td>${po.approvedDate}</td>
                </tr>
            `).join('');
        }

        function renderRejectedProjects() {
            const tbody = document.getElementById('rejected-projects-table');
            const rejectedProjects = state.projectOverview.filter(po => po.approvalStatus === 'Rejected');
            tbody.innerHTML = rejectedProjects.map(po => `
                <tr>
                    <td>${po.projectName}</td>
                    <td>${state.users.find(u => u.id === po.qaId)?.name || 'Unassigned'}</td>
                    <td>${state.projects.find(p => p.id === po.projectId)?.name || 'N/A'}</td>
                    <td>${po.projectCategory}</td>
                    <td>${po.projectSubcategory}</td>
                    <td>${po.currentPhase}</td>
                    <td>${po.ktReceived}</td>
                    <td>${po.startDate}</td>
                    <td>${po.endDate}</td>
                    <td>${po.status}</td>
                    <td>${po.totalBugs}</td>
                    <td class="bug-high">${po.highPriorityHtmlBugs || 0}</td>
                    <td class="bug-medium">${po.mediumPriorityHtmlBugs || 0}</td>
                    <td class="bug-low">${po.lowPriorityHtmlBugs || 0}</td>
                    <td class="bug-high">${po.highPriorityFunctionalBugs || 0}</td>
                    <td class="bug-medium">${po.mediumPriorityFunctionalBugs || 0}</td>
                    <td class="bug-low">${po.lowPriorityFunctionalBugs || 0}</td>
                    <td>${po.rejectionDate}</td>
                    <td>${po.rejectionReason}</td>
                    <td>${po.rejectedBy}</td>
                </tr>
            `).join('');
        }

        function renderReports() {
            const dateFilter = document.getElementById('report-filter-date').value;
            const qaFilter = document.getElementById('report-filter-qa').value;
            const projectFilter = document.getElementById('report-filter-project').value;
            const categoryFilter = document.getElementById('report-filter-category').value;
            const subcategoryFilter = document.getElementById('report-filter-subcategory').value;

            let filteredOverview = state.projectOverview;
            if (dateFilter) filteredOverview = filteredOverview.filter(po => po.startDate === dateFilter || po.endDate === dateFilter);
            if (qaFilter) filteredOverview = filteredOverview.filter(po => po.qaId === qaFilter);
            if (projectFilter) filteredOverview = filteredOverview.filter(po => po.projectId === projectFilter);
            if (categoryFilter) filteredOverview = filteredOverview.filter(po => po.projectCategory === categoryFilter);
            if (subcategoryFilter) filteredOverview = filteredOverview.filter(po => po.projectSubcategory === subcategoryFilter);

            const reportsList = document.getElementById('reports-list');
            reportsList.innerHTML = filteredOverview.length ? filteredOverview.map(po => `
                <div class="list-item">
                    <span>${po.projectName} - ${state.users.find(u => u.id === po.qaId)?.name || 'Unassigned'} - ${po.currentPhase} - Bugs: ${po.totalBugs}</span>
                </div>
            `).join('') : '<p>No reports match the selected filters.</p>';

            const bugStats = filteredOverview.reduce((stats, po) => {
                stats.total += po.totalBugs;
                stats.highHtml += po.highPriorityHtmlBugs || 0;
                stats.medHtml += po.mediumPriorityHtmlBugs || 0;
                stats.lowHtml += po.lowPriorityHtmlBugs || 0;
                stats.highFunc += po.highPriorityFunctionalBugs || 0;
                stats.medFunc += po.mediumPriorityFunctionalBugs || 0;
                stats.lowFunc += po.lowPriorityFunctionalBugs || 0;
                return stats;
            }, { total: 0, highHtml: 0, medHtml: 0, lowHtml: 0, highFunc: 0, medFunc: 0, lowFunc: 0 });

            document.getElementById('bug-stats').innerHTML = `
                <div class="widget">
                    <h3>Bug Statistics</h3>
                    <div class="stats-list">
                        <div class="stats-list-item">Total Bugs: ${bugStats.total}</div>
                        <div class="stats-list-item bug-high">High Priority HTML Bugs: ${bugStats.highHtml}</div>
                        <div class="stats-list-item bug-medium">Medium Priority HTML Bugs: ${bugStats.medHtml}</div>
                        <div class="stats-list-item bug-low">Low Priority HTML Bugs: ${bugStats.lowHtml}</div>
                        <div class="stats-list-item bug-high">High Priority Functional Bugs: ${bugStats.highFunc}</div>
                        <div class="stats-list-item bug-medium">Medium Priority Functional Bugs: ${bugStats.medFunc}</div>
                        <div class="stats-list-item bug-low">Low Priority Functional Bugs: ${bugStats.lowFunc}</div>
                    </div>
                </div>
            `;
        }

        function exportReport() {
            const filteredOverview = state.projectOverview.filter(po => {
                const dateFilter = document.getElementById('report-filter-date').value;
                const qaFilter = document.getElementById('report-filter-qa').value;
                const projectFilter = document.getElementById('report-filter-project').value;
                const categoryFilter = document.getElementById('report-filter-category').value;
                const subcategoryFilter = document.getElementById('report-filter-subcategory').value;
                return (!dateFilter || po.startDate === dateFilter || po.endDate === dateFilter) &&
                       (!qaFilter || po.qaId === qaFilter) &&
                       (!projectFilter || po.projectId === projectFilter) &&
                       (!categoryFilter || po.projectCategory === categoryFilter) &&
                       (!subcategoryFilter || po.projectSubcategory === subcategoryFilter);
            });

            const csv = [
                ['Project Name', 'Assigned QA', 'Project', 'Category', 'Subcategory', 'Phase', 'KT Received', 'Start Date', 'End Date', 'Status', 'Total Bugs', 'High HTML Bugs', 'Med HTML Bugs', 'Low HTML Bugs', 'High Func Bugs', 'Med Func Bugs', 'Low Func Bugs', 'TL Verification', 'Approval Status', 'Approved Date', 'Rejection Date', 'Rejection Reason', 'Rejected By'],
                ...filteredOverview.map(po => [
                    po.projectName,
                    state.users.find(u => u.id === po.qaId)?.name || 'Unassigned',
                    state.projects.find(p => p.id === po.projectId)?.name || 'N/A',
                    po.projectCategory,
                    po.projectSubcategory,
                    po.currentPhase,
                    po.ktReceived,
                    po.startDate,
                    po.endDate,
                    po.status,
                    po.totalBugs,
                    po.highPriorityHtmlBugs || 0,
                    po.mediumPriorityHtmlBugs || 0,
                    po.lowPriorityHtmlBugs || 0,
                    po.highPriorityFunctionalBugs || 0,
                    po.mediumPriorityFunctionalBugs || 0,
                    po.lowPriorityFunctionalBugs || 0,
                    po.tlVerification,
                    po.approvalStatus,
                    po.approvedDate,
                    po.rejectionDate,
                    po.rejectionReason,
                    po.rejectedBy
                ])
            ].map(row => row.map(cell => `"${cell}"`).join(',')).join('\n');

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `QA_Report_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            URL.revokeObjectURL(url);
            state.activityLog.push({ action: 'Exported QA report', user: state.currentUser.name, timestamp: Date.now() });
        }

        function renderActivityLog() {
            document.getElementById('activity-log-list').innerHTML = state.activityLog.slice().reverse().map(log => `
                <div class="list-item">
                    <span>${new Date(log.timestamp).toLocaleString()} - ${log.user}: ${log.action}</span>
                </div>
            `).join('');
        }

        function renderProfile() {
            document.getElementById('profile-name').value = state.currentUser.name;
        }

        function updateProfile() {
            const name = document.getElementById('profile-name').value.trim();
            if (!name) return showNotification('Name cannot be empty', null, true);
            const oldName = state.currentUser.name;
            state.currentUser.name = name;
            state.activityLog.push({ action: `Updated profile name from ${oldName} to ${name}`, user: state.currentUser.name, timestamp: Date.now() });
            showNotification('Profile updated');
            updateUserAvatar();
            loadInitialData();
            switchTab('dashboard');
        }

        function renderUsers() {
            document.getElementById('users-list').innerHTML = state.users.map(u => `
                <div class="list-item">
                    <span>${u.name} (${u.id}) - ${u.role} - ${u.email}</span>
                    <button class="btn-danger" onclick="deleteUser('${u.id}')">Delete</button>
                </div>
            `).join('');
        }

        function showUserForm() {
            const content = `
                <form id="user-form">
                    <div class="form-group">
                        <label for="user-id" class="required">User ID</label>
                        <input type="text" id="user-id" placeholder="e.g., u6" required>
                    </div>
                    <div class="form-group">
                        <label for="user-name" class="required">Name</label>
                        <input type="text" id="user-name" placeholder="e.g., John Doe" required>
                    </div>
                    <div class="form-group">
                        <label for="user-email" class="required">Email</label>
                        <input type="email" id="user-email" placeholder="e.g., john@example.com" required>
                    </div>
                    <div class="form-group">
                        <label for="user-role" class="required">Role</label>
                        <select id="user-role" required>
                            <option value="Team Lead">Team Lead</option>
                            <option value="QA Member">QA Member</option>
                            <option value="Admin">Admin</option>
                        </select>
                    </div>
                    <button type="submit" class="btn-primary">Add User</button>
                </form>
            `;
            showModal('Add User', content);
            document.getElementById('user-form').addEventListener('submit', (e) => {
                e.preventDefault();
                addUser();
            });
        }

        function addUser() {
            const id = document.getElementById('user-id').value.trim();
            const name = document.getElementById('user-name').value.trim();
            const email = document.getElementById('user-email').value.trim();
            const role = document.getElementById('user-role').value;
            if (!id || !name || !email || !role) return showNotification('All fields are required', null, true);
            if (state.users.some(u => u.id === id)) return showNotification('User ID already exists', null, true);

            state.users.push({ id, name, role, email });
            state.activityLog.push({ action: `Added user ${name} (${id})`, user: state.currentUser.name, timestamp: Date.now() });
            renderUsers();
            closeModal();
            showNotification('User added');
            loadInitialData();
        }

        function deleteUser(userId) {
            if (userId === state.currentUser.id) return showNotification('Cannot delete yourself', null, true);
            const user = state.users.find(u => u.id === userId);
            state.users = state.users.filter(u => u.id !== userId);
            state.activityLog.push({ action: `Deleted user ${user.name} (${userId})`, user: state.currentUser.name, timestamp: Date.now() });
            renderUsers();
            showNotification('User deleted');
            loadInitialData();
        }

        function renderAssignRoles() {
            document.getElementById('roles-list').innerHTML = state.users.map(u => `
                <div class="list-item">
                    <span>${u.name} (${u.id}) - ${u.email}</span>
                    <select onchange="updateRole('${u.id}', this.value)">
                        <option value="Team Lead" ${u.role === 'Team Lead' ? 'selected' : ''}>Team Lead</option>
                        <option value="QA Member" ${u.role === 'QA Member' ? 'selected' : ''}>QA Member</option>
                        <option value="Admin" ${u.role === 'Admin' ? 'selected' : ''}>Admin</option>
                    </select>
                </div>
            `).join('');
        }

        function updateRole(userId, role) {
            if (userId === state.currentUser.id && role !== state.currentUser.role) {
                return showNotification('Cannot change your own role', null, true);
            }
            const user = state.users.find(u => u.id === userId);
            const oldRole = user.role;
            user.role = role;
            state.activityLog.push({ action: `Changed role of ${user.name} from ${oldRole} to ${role}`, user: state.currentUser.name, timestamp: Date.now() });
            showNotification(`Role updated for ${user.name}`);
            renderAssignRoles();
            setupSidebar();
        }

        function toggleSidebar() {
            document.querySelector('.sidebar').classList.toggle('collapsed');
        }

        function toggleTheme() {
            document.body.classList.toggle('light-mode');
            localStorage.setItem('theme', document.body.classList.contains('light-mode') ? 'light' : 'dark');
            state.activityLog.push({ action: `Switched to ${document.body.classList.contains('light-mode') ? 'light' : 'dark'} theme`, user: state.currentUser.name, timestamp: Date.now() });
        }

        function logout() {
            state.activityLog.push({ action: 'Logged out', user: state.currentUser.name, timestamp: Date.now() });
            state.currentUser = null;
            showNotification('Logged out');
            showLoginModal();
            document.getElementById('user-avatar').innerHTML = '';
            document.getElementById('user-name').textContent = '';
            document.getElementById('welcome-user').textContent = '';
        }

        function updateUserAvatar() {
            const avatar = document.getElementById('user-avatar');
            if (state.currentUser) {
                avatar.innerHTML = state.currentUser.name.charAt(0).toUpperCase();
            } else {
                avatar.innerHTML = '';
            }
        }

        function calculateDashboardStats() {
            const stats = {};
            state.projectCategories.forEach(category => {
                stats[category.name] = { projects: 0, pendingApprovals: 0, completedProjects: 0 };
            });

            state.projectOverview.forEach(po => {
                const category = po.projectCategory;
                if (stats[category]) {
                    stats[category].projects++;
                    if (po.approvalStatus === 'Not Set' || po.approvalStatus === '') stats[category].pendingApprovals++;
                    if (po.status === 'Completed') stats[category].completedProjects++;
                }
            });

            return stats;
        }

        function populateProjects() {
            state.projects = [
                { id: 'p1', name: 'Website Redesign', bugTrackerLink: 'https://gitlab.com/p1', status: 'In Progress', projectCategory: 'General Project Categories', projectSubcategory: 'HTML' },
                { id: 'p2', name: 'E-commerce Platform', bugTrackerLink: 'https://gitlab.com/p2', status: 'In Progress', projectCategory: 'PHP Projects (CMS-based)', projectSubcategory: 'Ecom PHP' }
            ];
        }

        function populateProjectOverview() {
            state.projectOverview = [
                { 
                    id: 'po1', 
                    projectId: 'p1', 
                    projectName: 'Website Redesign', 
                    qaId: 'u2', 
                    projectCategory: 'General Project Categories', 
                    projectSubcategory: 'HTML', 
                    currentPhase: 'HTML Comparison', 
                    ktReceived: 'Yes', 
                    startDate: '2025-03-01', 
                    endDate: '', 
                    status: 'In Progress', 
                    totalBugs: 5, 
                    highPriorityHtmlBugs: 1, 
                    mediumPriorityHtmlBugs: 2, 
                    lowPriorityHtmlBugs: 2, 
                    highPriorityFunctionalBugs: 0, 
                    mediumPriorityFunctionalBugs: 0, 
                    lowPriorityFunctionalBugs: 0, 
                    tlVerification: 'Not Requested', 
                    approvalStatus: 'Not Set', 
                    approvedDate: '', 
                    rejectionDate: '', 
                    rejectionReason: '', 
                    rejectedBy: '' 
                }
            ];
        }

        function populateTasks() {
            state.tasks = [
                { id: 't1', name: 'Test Homepage', projectId: 'p1', phase: 'HTML Comparison', assignedTo: 'u2', status: 'To Do' },
                { id: 't2', name: 'Checkout Flow', projectId: 'p2', phase: 'Dev Test', assignedTo: 'u4', status: 'In Progress' }
            ];
        }
    </script>
</body>
</html>
