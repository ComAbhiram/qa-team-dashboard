<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QA Team Dashboard</title>
    <link rel="icon" href="images/fav.png">
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400;500;700;900&family=Work+Sans:wght@400;500;700;900&display=swap">
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script src="https://unpkg.com/papaparse@5.3.2/papaparse.min.js"></script> <!-- For CSV export -->
    <style>
        :root {
            --primary: #fbd003; /* Yellow */
            --secondary: #929294; /* Gray */
            --dark-bg: #1a1a1a;
            --dark-card: #2a2a2a;
            --dark-hover: #3a3a3a;
            --light-bg: #f4f4f4;
            --light-card: #ffffff;
            --light-hover: #e0e0e0;
        }
        body {
            font-family: "Work Sans", "Noto Sans", sans-serif;
            background-color: var(--dark-bg);
            color: #ffffff;
            transition: all 0.3s ease;
        }
        body.light-theme {
            background-color: var(--light-bg);
            color: #333333;
        }
        .sidebar {
            height: 100vh;
            position: fixed;
            width: 280px;
            background-color: var(--dark-card);
            transition: all 0.3s ease;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.2);
        }
        body.light-theme .sidebar {
            background-color: var(--light-card);
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
        }
        .sidebar a, .sidebar button {
            transition: all 0.3s ease;
        }
        .sidebar a:hover, .sidebar button:hover {
            background-color: var(--primary);
            color: #000000;
            transform: translateX(5px);
        }
        .content {
            margin-left: 280px;
            padding: 20px;
            transition: margin-left 0.3s ease;
        }
        .table-container {
            overflow-x: auto;
            background-color: var(--dark-card);
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }
        body.light-theme .table-container {
            background-color: var(--light-card);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        .table-container th, .table-container td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--dark-hover);
        }
        body.light-theme .table-container th, body.light-theme .table-container td {
            border-bottom: 1px solid var(--light-hover);
        }
        .table-container th {
            background-color: var(--dark-hover);
            color: var(--primary);
            font-weight: bold;
            cursor: pointer;
        }
        body.light-theme .table-container th {
            background-color: var(--light-hover);
        }
        .btn-primary {
            background-color: var(--primary);
            color: #000000;
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            background-color: #e5bd00;
            transform: scale(1.05);
        }
        .btn-danger {
            background-color: #e24a4a;
            transition: all 0.3s ease;
        }
        .btn-danger:hover {
            background-color: #bd3535;
            transform: scale(1.05);
        }
        .btn-approved {
            background-color: #4a90e2;
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
        }
        .btn-rejected {
            background-color: #e24a4a;
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
        }
        .card {
            background-color: var(--dark-card);
            border-radius: 8px;
            padding: 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }
        body.light-theme .card {
            background-color: var(--light-card);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background-color: var(--dark-card);
            padding: 20px;
            border-radius: 8px;
            border: 1px solid var(--secondary);
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
        }
        body.light-theme .modal-content {
            background-color: var(--light-card);
        }
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: var(--primary);
            color: #000000;
            padding: 10px 20px;
            border-radius: 4px;
            z-index: 2000;
            display: none;
            cursor: pointer;
        }
        .editable:hover {
            background-color: var(--dark-hover);
            cursor: pointer;
        }
        body.light-theme .editable:hover {
            background-color: var(--light-hover);
        }
        .alert-due {
            background-color: #e24a4a;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            display: inline-block;
        }
        .tooltip {
            position: relative;
            display: inline-block;
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 120px;
            background-color: #555;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -60px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        .tab-pane {
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .tab-pane.active {
            display: block;
            opacity: 1;
        }
        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
            }
            .content {
                margin-left: 0;
            }
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div id="login-page" class="flex min-h-screen items-center justify-center">
        <div class="bg-[var(--dark-card)] p-6 rounded-lg shadow-lg w-full max-w-md">
            <h2 class="text-2xl font-bold text-[var(--primary)] mb-6">QA Team Dashboard</h2>
            <form id="login-form">
                <div class="mb-4">
                    <label for="username" class="block text-sm font-medium mb-2">Employee Code</label>
                    <input type="text" id="username" class="w-full p-2 border rounded bg-[var(--dark-hover)] text-white" placeholder="Employee Code" required>
                </div>
                <div class="mb-6">
                    <label for="password" class="block text-sm font-medium mb-2">Password</label>
                    <input type="password" id="password" class="w-full p-2 border rounded bg-[var(--dark-hover)] text-white" placeholder="Password" required>
                </div>
                <button type="submit" class="btn-primary w-full py-2 rounded">Login</button>
            </form>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div id="dashboard" class="hidden">
        <div class="sidebar text-white p-4">
            <div class="flex items-center gap-3 mb-6">
                <img src="images/logo.png" alt="Logo" class="h-10">
                <h3 class="text-xl font-bold text-[var(--primary)]">QA Dashboard</h3>
            </div>
            <ul class="space-y-2">
                <li><a href="#dashboard-tab" class="nav-link block p-2 rounded">Dashboard</a></li>
                <li><a href="#projects-tab" class="nav-link block p-2 rounded">Projects Overview</a></li>
                <li><a href="#approved-tab" class="nav-link block p-2 rounded">Approved Projects</a></li>
                <li><a href="#rejected-tab" class="nav-link block p-2 rounded">Rejected Projects</a></li>
                <li><a href="#activity-tab" class="nav-link block p-2 rounded">Activity Log</a></li>
                <li class="team-lead-only hidden"><a href="#manage-tab" class="nav-link block p-2 rounded">Project Management</a></li>
                <li class="team-lead-only hidden"><a href="#users-tab" class="nav-link block p-2 rounded">User Management</a></li>
                <li><a href="#help-tab" class="nav-link block p-2 rounded">Help</a></li>
                <li><a href="#profile-tab" class="nav-link block p-2 rounded">Profile</a></li>
                <li><button onclick="logout()" class="btn-danger w-full p-2 rounded mt-4">Logout</button></li>
            </ul>
        </div>

        <div class="content">
            <div id="notification" class="notification" onclick="this.style.display='none'" role="alert"></div>
            <div class="tab-content">
                <!-- Dashboard Tab -->
                <div id="dashboard-tab" class="tab-pane active">
                    <h1 class="text-3xl font-bold mb-4 text-[var(--primary)]">Welcome <span id="user-name"></span></h1>
                    <div class="card mb-6">
                        <h3 class="text-lg font-bold mb-4">Daily Standup Form</h3>
                        <div class="table-container">
                            <table role="grid">
                                <thead>
                                    <tr>
                                        <th onclick="sortTable('standup-tasks-table', 0)">Task Name</th>
                                        <th onclick="sortTable('standup-tasks-table', 1)">Project Name</th>
                                        <th onclick="sortTable('standup-tasks-table', 2)">Assigned Date</th>
                                        <th onclick="sortTable('standup-tasks-table', 3)">Due Date</th>
                                        <th onclick="sortTable('standup-tasks-table', 4)">Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="standup-tasks-table"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Projects Overview Tab -->
                <div id="projects-tab" class="tab-pane">
                    <h1 class="text-3xl font-bold mb-6 text-[var(--primary)]">Projects Overview</h1>
                    <div class="card mb-4">
                        <input type="text" id="project-search" class="p-2 border rounded bg-[var(--dark-hover)] text-white w-full" placeholder="Search projects..." aria-label="Search projects">
                    </div>
                    <div class="table-container">
                        <table role="grid">
                            <thead>
                                <tr>
                                    <th onclick="sortTable('projects-table', 0)">Project Name</th>
                                    <th onclick="sortTable('projects-table', 1)">Category</th>
                                    <th onclick="sortTable('projects-table', 2)">Type</th>
                                    <th onclick="sortTable('projects-table', 3)">Phase</th>
                                    <th onclick="sortTable('projects-table', 4)">KT Received</th>
                                    <th onclick="sortTable('projects-table', 5)">Start</th>
                                    <th onclick="sortTable('projects-table', 6)">End</th>
                                    <th onclick="sortTable('projects-table', 7)">Status</th>
                                    <th onclick="sortTable('projects-table', 8)">Total Bugs</th>
                                    <th onclick="sortTable('projects-table', 9)">HTML Bugs</th>
                                    <th onclick="sortTable('projects-table', 10)">Func Bugs</th>
                                    <th onclick="sortTable('projects-table', 11)">QA</th>
                                    <th>Bug Tracker</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="projects-table"></tbody>
                        </table>
                    </div>
                </div>

                <!-- Approved Projects Tab -->
                <div id="approved-tab" class="tab-pane">
                    <h1 class="text-3xl font-bold mb-6 text-[var(--primary)]">Approved Projects</h1>
                    <div class="card mb-4">
                        <input type="text" id="approved-search" class="p-2 border rounded bg-[var(--dark-hover)] text-white w-full" placeholder="Search approved projects..." aria-label="Search approved projects">
                    </div>
                    <div class="table-container">
                        <table role="grid">
                            <thead>
                                <tr>
                                    <th onclick="sortTable('approved-table', 0)">Project Name</th>
                                    <th onclick="sortTable('approved-table', 1)">QA</th>
                                    <th onclick="sortTable('approved-table', 2)">Approved Date</th>
                                    <th onclick="sortTable('approved-table', 3)">Status</th>
                                </tr>
                            </thead>
                            <tbody id="approved-table"></tbody>
                        </table>
                    </div>
                </div>

                <!-- Rejected Projects Tab -->
                <div id="rejected-tab" class="tab-pane">
                    <h1 class="text-3xl font-bold mb-6 text-[var(--primary)]">Rejected Projects</h1>
                    <div class="card mb-4">
                        <input type="text" id="rejected-search" class="p-2 border rounded bg-[var(--dark-hover)] text-white w-full" placeholder="Search rejected projects..." aria-label="Search rejected projects">
                    </div>
                    <div class="table-container">
                        <table role="grid">
                            <thead>
                                <tr>
                                    <th onclick="sortTable('rejected-table', 0)">Project Name</th>
                                    <th onclick="sortTable('rejected-table', 1)">QA</th>
                                    <th onclick="sortTable('rejected-table', 2)">Rejected Date</th>
                                    <th onclick="sortTable('rejected-table', 3)">Phase</th>
                                    <th onclick="sortTable('rejected-table', 4)">PC</th>
                                    <th onclick="sortTable('rejected-table', 5)">Reason</th>
                                </tr>
                            </thead>
                            <tbody id="rejected-table"></tbody>
                        </table>
                    </div>
                </div>

                <!-- Activity Log Tab -->
                <div id="activity-tab" class="tab-pane">
                    <h1 class="text-3xl font-bold mb-6 text-[var(--primary)]">Activity Log</h1>
                    <div class="card mb-4">
                        <input type="text" id="activity-search" class="p-2 border rounded bg-[var(--dark-hover)] text-white w-full" placeholder="Search activity..." aria-label="Search activity log">
                    </div>
                    <div class="table-container">
                        <table role="grid">
                            <thead>
                                <tr>
                                    <th onclick="sortTable('activity-table', 0)">Project Name</th>
                                    <th onclick="sortTable('activity-table', 1)">QA</th>
                                    <th onclick="sortTable('activity-table', 2)">Activity Type</th>
                                    <th onclick="sortTable('activity-table', 3)">Details</th>
                                    <th onclick="sortTable('activity-table', 4)">Timestamp</th>
                                </tr>
                            </thead>
                            <tbody id="activity-table"></tbody>
                        </table>
                    </div>
                </div>

                <!-- Project Management Tab (Team Lead Only) -->
                <div id="manage-tab" class="tab-pane">
                    <h1 class="text-3xl font-bold mb-6 text-[var(--primary)]">Project Management</h1>
                    <div class="card mb-6">
                        <h3 class="text-lg font-bold mb-4">Create Project</h3>
                        <form id="create-project-form" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <input type="text" id="project-name" class="p-2 border rounded bg-[var(--dark-hover)] text-white" placeholder="Project Name" required aria-label="Project Name">
                            <select id="project-category" class="p-2 border rounded bg-[var(--dark-hover)] text-white" required aria-label="Project Category">
                                <option value="">Select Category</option>
                                <option value="Web">Web</option>
                                <option value="Mobile">Mobile</option>
                                <option value="Hybrid">Hybrid</option>
                            </select>
                            <select id="project-type" class="p-2 border rounded bg-[var(--dark-hover)] text-white" required aria-label="Project Type">
                                <option value="">Select Type</option>
                                <option value="WordPress">WordPress</option>
                                <option value="PHP">PHP</option>
                                <option value="iOS">iOS</option>
                                <option value="Android">Android</option>
                            </select>
                            <select id="project-phase" class="p-2 border rounded bg-[var(--dark-hover)] text-white" required aria-label="Project Phase">
                                <option value="">Select Phase</option>
                                <option value="HTML">HTML</option>
                                <option value="Development">Development</option>
                                <option value="Live">Live</option>
                            </select>
                            <input type="url" id="bug-tracker" class="p-2 border rounded bg-[var(--dark-hover)] text-white" placeholder="Bug Tracker Link" required aria-label="Bug Tracker Link">
                            <input type="date" id="start-date" class="p-2 border rounded bg-[var(--dark-hover)] text-white" required aria-label="Start Date">
                            <input type="date" id="end-date" class="p-2 border rounded bg-[var(--dark-hover)] text-white" required aria-label="End Date">
                            <button type="submit" class="btn-primary py-2 px-4 rounded col-span-full md:col-span-1" aria-label="Create Project">Create Project</button>
                        </form>
                    </div>
                    <div class="card mb-6">
                        <h3 class="text-lg font-bold mb-4">Assign Task to QA</h3>
                        <form id="assign-task-form" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <select id="assign-project" class="p-2 border rounded bg-[var(--dark-hover)] text-white" required aria-label="Select Project">
                                <option value="">Select Project</option>
                            </select>
                            <select id="assign-qa" class="p-2 border rounded bg-[var(--dark-hover)] text-white" required aria-label="Select QA">
                                <option value="">Select QA</option>
                            </select>
                            <select id="project-phase" class="p-2 border rounded bg-[var(--dark-hover)] text-white" required aria-label="Select Phase">
                                <option value="">Select Phase</option>
                                <option value="HTML">HTML</option>
                                <option value="Development">Development</option>
                                <option value="Live">Live</option>
                            </select>
                            <input type="text" id="task-name" class="p-2 border rounded bg-[var(--dark-hover)] text-white" placeholder="Task Name" required aria-label="Task Name">
                            <input type="date" id="due-date" class="p-2 border rounded bg-[var(--dark-hover)] text-white" required aria-label="Due Date">
                            <button type="submit" class="btn-primary py-2 px-4 rounded col-span-full md:col-span-1" aria-label="Assign Task">Assign Task</button>
                        </form>
                    </div>
                    <div class="card">
                        <h3 class="text-lg font-bold mb-4">Generate Reports</h3>
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                            <select class="p-2 border rounded bg-[var(--dark-hover)] text-white" id="report-type" aria-label="Report Type">
                                <option value="monthly">Monthly QA Report</option>
                                <option value="rejected">Rejected Report</option>
                                <option value="qa-wise">QA-Wise Report</option>
                            </select>
                            <input type="month" id="report-month" class="p-2 border rounded bg-[var(--dark-hover)] text-white" aria-label="Report Month">
                            <select id="report-qa" class="p-2 border rounded bg-[var(--dark-hover)] text-white" aria-label="Select QA for Report">
                                <option value="">All QA</option>
                            </select>
                            <input type="text" id="report-project" class="p-2 border rounded bg-[var(--dark-hover)] text-white" placeholder="Project (Optional)" aria-label="Project Name for Report">
                        </div>
                        <button class="btn-primary py-2 px-4 rounded" onclick="exportReport()" aria-label="Export Report">Export Report</button>
                    </div>
                </div>

                <!-- User Management Tab (Team Lead Only) -->
                <div id="users-tab" class="tab-pane">
                    <h1 class="text-3xl font-bold mb-6 text-[var(--primary)]">User Management</h1>
                    <div class="card mb-6">
                        <h3 class="text-lg font-bold mb-4">Add User</h3>
                        <form id="add-user-form" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <input type="text" id="new-username" class="p-2 border rounded bg-[var(--dark-hover)] text-white" placeholder="Employee Code" required aria-label="Employee Code">
                            <input type="password" id="new-password" class="p-2 border rounded bg-[var(--dark-hover)] text-white" placeholder="Password" required aria-label="Password">
                            <input type="text" id="new-name" class="p-2 border rounded bg-[var(--dark-hover)] text-white" placeholder="Full Name" required aria-label="Full Name">
                            <select id="new-role" class="p-2 border rounded bg-[var(--dark-hover)] text-white" required aria-label="Role">
                                <option value="QA Member">QA Member</option>
                                <option value="Team Lead">Team Lead</option>
                            </select>
                            <button type="submit" class="btn-primary py-2 px-4 rounded col-span-full md:col-span-1" aria-label="Add User">Add User</button>
                        </form>
                    </div>
                    <div class="card">
                        <h3 class="text-lg font-bold mb-4">Existing Users</h3>
                        <div class="table-container">
                            <table role="grid">
                                <thead>
                                    <tr>
                                        <th>Employee Code</th>
                                        <th>Name</th>
                                        <th>Role</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="users-table"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Help Tab -->
                <div id="help-tab" class="tab-pane">
                    <h1 class="text-3xl font-bold mb-6 text-[var(--primary)]">Help & Guidelines</h1>
                    <div class="card">
                        <h3 class="text-lg font-bold mb-4">QA Guidelines</h3>
                        <p class="text-[var(--secondary)] mb-4">Follow these guidelines to ensure quality testing:</p>
                        <ul class="list-disc list-inside text-[var(--secondary)]">
                            <li>Always perform HTML-to-UI comparison during the HTML phase.</li>
                            <li>Log all bugs in the GitLab tracker with detailed descriptions.</li>
                            <li>Reject projects with 3+ reopened bugs and notify the QA Lead.</li>
                            <li>Conduct a smoke test before final approval for go-live.</li>
                        </ul>
                    </div>
                </div>

                <!-- Profile Tab -->
                <div id="profile-tab" class="tab-pane">
                    <h1 class="text-3xl font-bold mb-6 text-[var(--primary)]">User Profile</h1>
                    <div class="card">
                        <h3 class="text-lg font-bold mb-4">Profile Details</h3>
                        <form id="profile-form">
                            <div class="mb-4">
                                <label for="profile-username" class="block text-sm font-medium mb-2">Employee Code</label>
                                <input type="text" id="profile-username" class="w-full p-2 border rounded bg-[var(--dark-hover)] text-white" readonly aria-label="Employee Code">
                            </div>
                            <div class="mb-4">
                                <label for="profile-role" class="block text-sm font-medium mb-2">Role</label>
                                <input type="text" id="profile-role" class="w-full p-2 border rounded bg-[var(--dark-hover)] text-white" readonly aria-label="Role">
                            </div>
                            <div class="mb-4">
                                <label for="profile-email" class="block text-sm font-medium mb-2">Email</label>
                                <input type="email" id="profile-email" class="w-full p-2 border rounded bg-[var(--dark-hover)] text-white" placeholder="Enter your email" aria-label="Email">
                            </div>
                            <div class="mb-4">
                                <label for="change-password" class="block text-sm font-medium mb-2">Change Password</label>
                                <input type="password" id="change-password" class="w-full p-2 border rounded bg-[var(--dark-hover)] text-white" placeholder="New Password" aria-label="New Password">
                            </div>
                            <div class="mb-4">
                                <label for="theme-toggle" class="block text-sm font-medium mb-2">Theme</label>
                                <select id="theme-toggle" class="p-2 border rounded bg-[var(--dark-hover)] text-white" aria-label="Select Theme">
                                    <option value="dark">Dark Theme</option>
                                    <option value="light">Light Theme</option>
                                </select>
                            </div>
                            <button type="submit" class="btn-primary py-2 px-4 rounded" aria-label="Save Profile">Save Profile</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="edit-project-modal" class="modal">
        <div class="modal-content">
            <h3 class="text-lg font-bold mb-4 text-[var(--primary)]">Edit Project</h3>
            <form id="edit-project-form">
                <input type="hidden" id="edit-project-id">
                <div class="mb-4">
                    <label for="edit-project-name" class="block text-sm font-medium mb-2">Project Name</label>
                    <input type="text" id="edit-project-name" class="w-full p-2 border rounded bg-[var(--dark-hover)] text-white" required aria-label="Project Name">
                </div>
                <div class="mb-4">
                    <label for="edit-project-category" class="block text-sm font-medium mb-2">Category</label>
                    <select id="edit-project-category" class="w-full p-2 border rounded bg-[var(--dark-hover)] text-white" required aria-label="Project Category">
                        <option value="Web">Web</option>
                        <option value="Mobile">Mobile</option>
                        <option value="Hybrid">Hybrid</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label for="edit-project-type" class="block text-sm font-medium mb-2">Type</label>
                    <select id="edit-project-type" class="w-full p-2 border rounded bg-[var(--dark-hover)] text-white" required aria-label="Project Type">
                        <option value="WordPress">WordPress</option>
                        <option value="PHP">PHP</option>
                        <option value="iOS">iOS</option>
                        <option value="Android">Android</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label for="edit-project-phase" class="block text-sm font-medium mb-2">Phase</label>
                    <select id="edit-project-phase" class="w-full p-2 border rounded bg-[var(--dark-hover)] text-white" required aria-label="Project Phase">
                        <option value="HTML">HTML</option>
                        <option value="Development">Development</option>
                        <option value="Live">Live</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label for="edit-project-kt" class="block text-sm font-medium mb-2">KT Received</label>
                    <select id="edit-project-kt" class="w-full p-2 border rounded bg-[var(--dark-hover)] text-white" required aria-label="KT Received">
                        <option value="Yes">Yes</option>
                        <option value="No">No</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label for="edit-project-start" class="block text-sm font-medium mb-2">Start Date</label>
                    <input type="date" id="edit-project-start" class="w-full p-2 border rounded bg-[var(--dark-hover)] text-white" required aria-label="Start Date">
                </div>
                <div class="mb-4">
                    <label for="edit-project-end" class="block text-sm font-medium mb-2">End Date</label>
                    <input type="date" id="edit-project-end" class="w-full p-2 border rounded bg-[var(--dark-hover)] text-white" required aria-label="End Date">
                </div>
                <div class="mb-4">
                    <label for="edit-project-bug-tracker" class="block text-sm font-medium mb-2">Bug Tracker Link</label>
                    <input type="url" id="edit-project-bug-tracker" class="w-full p-2 border rounded bg-[var(--dark-hover)] text-white" required aria-label="Bug Tracker Link">
                </div>
                <div class="mb-4">
                    <label for="edit-project-qa" class="block text-sm font-medium mb-2">Assigned QA</label>
                    <select id="edit-project-qa" class="w-full p-2 border rounded bg-[var(--dark-hover)] text-white" required aria-label="Assigned QA">
                        <option value="">Not Assigned</option>
                    </select>
                </div>
                <div class="flex justify-end gap-2">
                    <button type="button" onclick="closeModal('edit-project-modal')" class="p-2 bg-[var(--secondary)] text-white rounded" aria-label="Cancel">Cancel</button>
                    <button type="submit" class="btn-primary py-2 px-4 rounded" aria-label="Save Project">Save</button>
                </div>
            </form>
        </div>
    </div>

    <div id="report-bug-modal" class="modal">
        <div class="modal-content">
            <h3 class="text-lg font-bold mb-4 text-[var(--primary)]">Report Bug</h3>
            <form id="report-bug-form">
                <input type="hidden" id="bug-project-id">
                <div class="mb-4">
                    <label for="bug-type" class="block text-sm font-medium mb-2">Bug Type</label>
                    <select id="bug-type" class="w-full p-2 border rounded bg-[var(--dark-hover)] text-white" required aria-label="Bug Type">
                        <option value="HTML">HTML Bug</option>
                        <option value="Functional">Functional Bug</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label for="bug-description" class="block text-sm font-medium mb-2">Description</label>
                    <textarea id="bug-description" class="w-full p-2 border rounded bg-[var(--dark-hover)] text-white" required aria-label="Bug Description"></textarea>
                </div>
                <div class="flex justify-end gap-2">
                    <button type="button" onclick="closeModal('report-bug-modal')" class="p-2 bg-[var(--secondary)] text-white rounded" aria-label="Cancel">Cancel</button>
                    <button type="submit" class="btn-primary py-2 px-4 rounded" aria-label="Report Bug">Report Bug</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        let credentials = JSON.parse(localStorage.getItem('credentials')) || {
            'abhiram@intersmart.in': { password: 'lead123', role: 'Team Lead', name: 'Abhiram P Mohan' },
            'Minnu@intersmart.in': { password: 'qa1234', role: 'QA Member', name: 'Minnu Sebastian' },
            'Aswathi@intersmart.in': { password: 'qa4564', role: 'QA Member', name: 'Aswathi M Asok' }
        };
        let currentUser = null;
        let tasks = JSON.parse(localStorage.getItem('tasks')) || [];
        let projects = JSON.parse(localStorage.getItem('projects')) || [];
        let approvedProjects = JSON.parse(localStorage.getItem('approvedProjects')) || [];
        let rejectedProjects = JSON.parse(localStorage.getItem('rejectedProjects')) || [];
        let activityLog = JSON.parse(localStorage.getItem('activityLog')) || [];
        let userProfiles = JSON.parse(localStorage.getItem('userProfiles')) || {};

        // Load Theme
        document.addEventListener('DOMContentLoaded', () => {
            const savedTheme = localStorage.getItem('theme') || 'dark';
            document.body.classList.toggle('light-theme', savedTheme === 'light');
            document.getElementById('theme-toggle').value = savedTheme;
            populateQADropdowns();
            renderUsersTable();
        });

        // Login
        document.getElementById('login-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            if (credentials[username] && credentials[username].password === password) {
                currentUser = { username, ...credentials[username] };
                document.getElementById('login-page').classList.add('hidden');
                document.getElementById('dashboard').classList.remove('hidden');
                document.getElementById('user-name').textContent = currentUser.name;
                if (currentUser.role === 'Team Lead') {
                    document.querySelectorAll('.team-lead-only').forEach(el => el.classList.remove('hidden'));
                }
                loadDashboardData();
            } else {
                showNotification('Invalid credentials');
            }
        });

        // Logout
        function logout() {
            currentUser = null;
            document.getElementById('dashboard').classList.add('hidden');
            document.getElementById('login-page').classList.remove('hidden');
        }

        // Tab Navigation
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                document.querySelectorAll('.tab-pane').forEach(tab => tab.classList.remove('active'));
                const targetTab = document.getElementById(link.getAttribute('href').substring(1));
                targetTab.classList.add('active');
                targetTab.style.opacity = 0;
                setTimeout(() => targetTab.style.opacity = 1, 10);
            });
            link.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') link.click();
            });
        });

        // Notifications
        function showNotification(message) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.style.display = 'block';
            setTimeout(() => notification.style.display = 'none', 3000);
        }

        // Modal Handling
        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.style.display = 'flex';
            modal.querySelector('input, select, textarea').focus();
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Load Dashboard Data
        function loadDashboardData() {
            renderStandupTasksTable();
            renderProjectsTable(projects);
            renderApprovedTable(approvedProjects);
            renderRejectedTable(rejectedProjects);
            renderActivityTable(activityLog);
            renderProfile();
            populateProjectDropdown();
            renderUsersTable();
        }

        // Render Daily Standup Form as a Table
        function renderStandupTasksTable() {
            const table = document.getElementById('standup-tasks-table');
            table.innerHTML = tasks
                .filter(t => t.assignee === currentUser.username)
                .map(t => {
                    const dueDate = new Date(t.dueDate);
                    const today = new Date();
                    const isDueSoon = dueDate - today < 24 * 60 * 60 * 1000 && dueDate > today;
                    return `
                        <tr>
                            <td>${t.name}</td>
                            <td>${t.projectName}</td>
                            <td>${t.assignedDate}</td>
                            <td>${t.dueDate} ${isDueSoon ? '<span class="alert-due">Due Soon</span>' : ''}</td>
                            <td>${t.status === 'inprogress' ? 'In Progress' : 'Completed'}</td>
                            <td>
                                ${t.status === 'inprogress' ? `
                                    <button class="text-green-400 text-sm tooltip" onclick="markTaskCompleted('${t.id}')" aria-label="Mark task as completed">
                                        Mark as Completed
                                        <span class="tooltiptext">Mark this task as completed</span>
                                    </button>
                                ` : ''}
                                ${currentUser.role === 'Team Lead' ? `
                                    <button class="text-red-400 text-sm ml-2 tooltip" onclick="deleteTask('${t.id}')" aria-label="Delete task">
                                        Delete
                                        <span class="tooltiptext">Delete this task</span>
                                    </button>
                                ` : ''}
                            </td>
                        </tr>
                    `;
                }).join('');
        }

        // Mark Task as Completed
        function markTaskCompleted(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (task) {
                task.status = 'completed';
                localStorage.setItem('tasks', JSON.stringify(tasks));
                logActivity(task.projectId, currentUser.username, 'Task Completed', `Marked "${task.name}" as completed`);
                renderStandupTasksTable();
                showNotification(`Task "${task.name}" marked as completed`);
            }
        }

        // Delete Task
        function deleteTask(taskId) {
            if (confirm('Are you sure you want to delete this task?')) {
                tasks = tasks.filter(t => t.id !== taskId);
                localStorage.setItem('tasks', JSON.stringify(tasks));
                renderStandupTasksTable();
                showNotification('Task deleted successfully');
            }
        }

        // Assign Task
        document.getElementById('assign-task-form').addEventListener('submit', (e) => {
            e.preventDefault();
            if (currentUser.role !== 'Team Lead') return;
            const projectId = document.getElementById('assign-project').value;
            const qa = document.getElementById('assign-qa').value;
            const phase = document.getElementById('project-phase').value;
            const taskName = document.getElementById('task-name').value;
            const dueDate = document.getElementById('due-date').value;

            const project = projects.find(p => p.id === projectId);
            if (project) {
                const newTask = {
                    id: Date.now().toString(),
                    projectId: projectId,
                    projectName: project.name,
                    name: taskName,
                    assignee: qa,
                    assignedDate: new Date().toISOString().split('T')[0],
                    dueDate: dueDate,
                    status: 'inprogress'
                };
                tasks.push(newTask);
                project.assignedQA = qa;
                project.phase = phase;
                localStorage.setItem('tasks', JSON.stringify(tasks));
                localStorage.setItem('projects', JSON.stringify(projects));
                logActivity(projectId, qa, 'Task Assigned', `Assigned "${taskName}" to ${credentials[qa].name}`);
                renderStandupTasksTable();
                renderProjectsTable(projects);
                showNotification(`Task "${taskName}" assigned to ${credentials[qa].name}`);
                e.target.reset();
            }
        });

        // Projects Table
        function renderProjectsTable(data) {
            const table = document.getElementById('projects-table');
            table.innerHTML = data.map(p => `
                <tr>
                    <td class="editable" onclick="editProject('${p.id}')">${p.name}</td>
                    <td>${p.category}</td>
                    <td>${p.type}</td>
                    <td>${p.phase}</td>
                    <td>${p.kt}</td>
                    <td>${p.start}</td>
                    <td>${p.end}</td>
                    <td>${p.status}</td>
                    <td>${p.bugs}</td>
                    <td>${p.htmlBugs}</td>
                    <td>${p.funcBugs}</td>
                    <td>${credentials[p.assignedQA]?.name || 'Not Assigned'}</td>
                    <td><a href="${p.bugTracker || '#'}" target="_blank" aria-label="View Bug Tracker">${p.bugTracker ? 'View' : 'N/A'}</a></td>
                    <td>
                        <button class="text-blue-400 text-sm mr-2 tooltip" onclick="openReportBugModal('${p.id}')" aria-label="Report a bug">
                            Report Bug
                            <span class="tooltiptext">Report a bug for this project</span>
                        </button>
                        ${currentUser.role === 'Team Lead' ? `
                            <button class="text-green-400 text-sm mr-2 tooltip" onclick="approveProject('${p.id}')" aria-label="Approve project">
                                Approve
                                <span class="tooltiptext">Approve this project</span>
                            </button>
                            <button class="text-red-400 text-sm mr-2 tooltip" onclick="rejectProject('${p.id}')" aria-label="Reject project">
                                Reject
                                <span class="tooltiptext">Reject this project</span>
                            </button>
                            <button class="text-red-400 text-sm tooltip" onclick="deleteProject('${p.id}')" aria-label="Delete project">
                                Delete
                                <span class="tooltiptext">Delete this project</span>
                            </button>
                        ` : ''}
                    </td>
                </tr>
            `).join('');
        }

        function editProject(projectId) {
            if (currentUser.role !== 'Team Lead') return;
            const project = projects.find(p => p.id === projectId);
            if (project) {
                document.getElementById('edit-project-id').value = project.id;
                document.getElementById('edit-project-name').value = project.name;
                document.getElementById('edit-project-category').value = project.category;
                document.getElementById('edit-project-type').value = project.type;
                document.getElementById('edit-project-phase').value = project.phase;
                document.getElementById('edit-project-kt').value = project.kt;
                document.getElementById('edit-project-start').value = project.start;
                document.getElementById('edit-project-end').value = project.end;
                document.getElementById('edit-project-bug-tracker').value = project.bugTracker;
                document.getElementById('edit-project-qa').value = project.assignedQA || '';
                openModal('edit-project-modal');
            }
        }

        document.getElementById('edit-project-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const projectId = document.getElementById('edit-project-id').value;
            const project = projects.find(p => p.id === projectId);
            if (project) {
                project.name = document.getElementById('edit-project-name').value;
                project.category = document.getElementById('edit-project-category').value;
                project.type = document.getElementById('edit-project-type').value;
                project.phase = document.getElementById('edit-project-phase').value;
                project.kt = document.getElementById('edit-project-kt').value;
                project.start = document.getElementById('edit-project-start').value;
                project.end = document.getElementById('edit-project-end').value;
                project.bugTracker = document.getElementById('edit-project-bug-tracker').value;
                project.assignedQA = document.getElementById('edit-project-qa').value;
                localStorage.setItem('projects', JSON.stringify(projects));
                logActivity(projectId, currentUser.username, 'Project Updated', `Edited project details`);
                renderProjectsTable(projects);
                closeModal('edit-project-modal');
                showNotification('Project updated successfully');
            }
        });

        // Report Bug
        function openReportBugModal(projectId) {
            document.getElementById('bug-project-id').value = projectId;
            openModal('report-bug-modal');
        }

        document.getElementById('report-bug-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const projectId = document.getElementById('bug-project-id').value;
            const bugType = document.getElementById('bug-type').value;
            const description = document.getElementById('bug-description').value;

            const project = projects.find(p => p.id === projectId);
            if (project) {
                project.bugs = (project.bugs || 0) + 1;
                if (bugType === 'HTML') project.htmlBugs = (project.htmlBugs || 0) + 1;
                else project.funcBugs = (project.funcBugs || 0) + 1;
                project.status = 'Awaiting Fixes';
                localStorage.setItem('projects', JSON.stringify(projects));
                logActivity(projectId, currentUser.username, 'Bug Reported', `${bugType} bug: ${description}`);
                renderProjectsTable(projects);
                closeModal('report-bug-modal');
                showNotification(`Bug reported for ${project.name}`);
            }
        });

        // Approve/Reject Project
        function approveProject(projectId) {
            if (currentUser.role !== 'Team Lead') return;
            const project = projects.find(p => p.id === projectId);
            if (project) {
                approvedProjects.push({
                    id: Date.now().toString(),
                    projectId: projectId,
                    name: project.name,
                    qa: project.assignedQA || 'Not Assigned',
                    date: new Date().toISOString().split('T')[0]
                });
                projects = projects.filter(p => p.id !== projectId);
                localStorage.setItem('projects', JSON.stringify(projects));
                localStorage.setItem('approvedProjects', JSON.stringify(approvedProjects));
                logActivity(projectId, currentUser.username, 'Project Approved', `Approved for live`);
                renderProjectsTable(projects);
                renderApprovedTable(approvedProjects);
                showNotification(`Project ${project.name} approved`);
            }
        }

        function rejectProject(projectId) {
            if (currentUser.role !== 'Team Lead') return;
            const project = projects.find(p => p.id === projectId);
            if (project) {
                const reason = prompt('Enter reason for rejection:');
                if (reason) {
                    rejectedProjects.push({
                        id: Date.now().toString(),
                        projectId: projectId,
                        name: project.name,
                        qa: project.assignedQA || 'Not Assigned',
                        date: new Date().toISOString().split('T')[0],
                        phase: project.phase,
                        pc: 'Bindhu', // Placeholder
                        reason: reason
                    });
                    projects = projects.filter(p => p.id !== projectId);
                    localStorage.setItem('projects', JSON.stringify(projects));
                    localStorage.setItem('rejectedProjects', JSON.stringify(rejectedProjects));
                    logActivity(projectId, currentUser.username, 'Project Rejected', `Reason: ${reason}`);
                    renderProjectsTable(projects);
                    renderRejectedTable(rejectedProjects);
                    showNotification(`Project ${project.name} rejected`);
                }
            }
        }

        function deleteProject(projectId) {
            if (currentUser.role !== 'Team Lead') return;
            if (confirm('Are you sure you want to delete this project?')) {
                projects = projects.filter(p => p.id !== projectId);
                localStorage.setItem('projects', JSON.stringify(projects));
                logActivity(projectId, currentUser.username, 'Project Deleted', `Project removed`);
                renderProjectsTable(projects);
                showNotification('Project deleted successfully');
            }
        }

        // Search Projects
        document.getElementById('project-search').addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            const filteredProjects = projects.filter(p => 
                p.name.toLowerCase().includes(searchTerm) ||
                p.category.toLowerCase().includes(searchTerm) ||
                p.type.toLowerCase().includes(searchTerm) ||
                (p.assignedQA && credentials[p.assignedQA]?.name.toLowerCase().includes(searchTerm))
            );
            renderProjectsTable(filteredProjects);
        });

        // Approved Projects Table
        function renderApprovedTable(data) {
            const table = document.getElementById('approved-table');
            table.innerHTML = data.map(p => `
                <tr>
                    <td>${p.name}</td>
                    <td>${credentials[p.qa]?.name || 'Not Assigned'}</td>
                    <td>${p.date}</td>
                    <td><span class="btn-approved">APPROVED</span></td>
                </tr>
            `).join('');
        }

        document.getElementById('approved-search').addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            const filteredProjects = approvedProjects.filter(p => 
                p.name.toLowerCase().includes(searchTerm) ||
                (p.qa && credentials[p.qa]?.name.toLowerCase().includes(searchTerm))
            );
            renderApprovedTable(filteredProjects);
        });

        // Rejected Projects Table
        function renderRejectedTable(data) {
            const table = document.getElementById('rejected-table');
            table.innerHTML = data.map(p => `
                <tr>
                    <td>${p.name}</td>
                    <td>${credentials[p.qa]?.name || 'Not Assigned'}</td>
                    <td>${p.date}</td>
                    <td>${p.phase}</td>
                    <td>${p.pc}</td>
                    <td>${p.reason}</td>
                </tr>
            `).join('');
        }

        document.getElementById('rejected-search').addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            const filteredProjects = rejectedProjects.filter(p => 
                p.name.toLowerCase().includes(searchTerm) ||
                (p.qa && credentials[p.qa]?.name.toLowerCase().includes(searchTerm)) ||
                p.reason.toLowerCase().includes(searchTerm)
            );
            renderRejectedTable(filteredProjects);
        });

        // Activity Log
        function renderActivityTable(data) {
            const table = document.getElementById('activity-table');
            table.innerHTML = data.map(a => `
                <tr>
                    <td>${projects.find(p => p.id === a.projectId)?.name || 'N/A'}</td>
                    <td>${credentials[a.qa]?.name || 'Unknown'}</td>
                    <td>${a.type}</td>
                    <td>${a.details}</td>
                    <td>${new Date(a.timestamp).toLocaleString()}</td>
                </tr>
            `).join('');
        }

        document.getElementById('activity-search').addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            const filteredActivity = activityLog.filter(a => 
                (projects.find(p => p.id === a.projectId)?.name.toLowerCase().includes(searchTerm)) ||
                (credentials[a.qa]?.name.toLowerCase().includes(searchTerm)) ||
                a.type.toLowerCase().includes(searchTerm) ||
                a.details.toLowerCase().includes(searchTerm)
            );
            renderActivityTable(filteredActivity);
        });

        function logActivity(projectId, qa, type, details) {
            activityLog.push({
                id: Date.now().toString(),
                projectId: projectId,
                qa: qa,
                type: type,
                details: details,
                timestamp: new Date().toISOString()
            });
            localStorage.setItem('activityLog', JSON.stringify(activityLog));
            renderActivityTable(activityLog);
        }

        // Create Project
        document.getElementById('create-project-form').addEventListener('submit', (e) => {
            e.preventDefault();
            if (currentUser.role !== 'Team Lead') return;
            const projectName = document.getElementById('project-name').value;
            const projectCategory = document.getElementById('project-category').value;
            const projectType = document.getElementById('project-type').value;
            const projectPhase = document.getElementById('project-phase').value;
            const bugTracker = document.getElementById('bug-tracker').value;
            const startDate = document.getElementById('start-date').value;
            const endDate = document.getElementById('end-date').value;

            const newProject = {
                id: Date.now().toString(),
                name: projectName,
                category: projectCategory,
                type: projectType,
                phase: projectPhase,
                kt: 'No',
                start: startDate,
                end: endDate,
                status: 'In Progress',
                bugs: 0,
                htmlBugs: 0,
                funcBugs: 0,
                assignedQA: '',
                bugTracker: bugTracker
            };
            projects.push(newProject);
            localStorage.setItem('projects', JSON.stringify(projects));
            logActivity(newProject.id, currentUser.username, 'Project Created', `Created ${projectName}`);
            renderProjectsTable(projects);
            populateProjectDropdown();
            showNotification(`Project ${projectName} created successfully`);
            e.target.reset();
        });

        // Populate Project Dropdown
        function populateProjectDropdown() {
            const projectSelect = document.getElementById('assign-project');
            projectSelect.innerHTML = '<option value="">Select Project</option>';
            projects.forEach(project => {
                const option = document.createElement('option');
                option.value = project.id;
                option.textContent = project.name;
                projectSelect.appendChild(option);
            });
        }

        // Populate QA Dropdowns
        function populateQADropdowns() {
            const assignQA = document.getElementById('assign-qa');
            const reportQA = document.getElementById('report-qa');
            const editQA = document.getElementById('edit-project-qa');
            assignQA.innerHTML = '<option value="">Select QA</option>';
            reportQA.innerHTML = '<option value="">All QA</option>';
            editQA.innerHTML = '<option value="">Not Assigned</option>';
            Object.keys(credentials).forEach(username => {
                const name = credentials[username].name;
                [assignQA, reportQA, editQA].forEach(select => {
                    const option = document.createElement('option');
                    option.value = username;
                    option.textContent = `${name} (${username})`;
                    select.appendChild(option);
                });
            });
        }

        // User Management
        document.getElementById('add-user-form').addEventListener('submit', (e) => {
            e.preventDefault();
            if (currentUser.role !== 'Team Lead') return;
            const username = document.getElementById('new-username').value;
            const password = document.getElementById('new-password').value;
            const name = document.getElementById('new-name').value;
            const role = document.getElementById('new-role').value;
            if (credentials[username]) {
                showNotification('User already exists');
                return;
            }
            credentials[username] = { password, role, name };
            localStorage.setItem('credentials', JSON.stringify(credentials));
            populateQADropdowns();
            renderUsersTable();
            showNotification(`User ${name} added successfully`);
            e.target.reset();
        });

        function renderUsersTable() {
            const table = document.getElementById('users-table');
            table.innerHTML = Object.keys(credentials).map(username => `
                <tr>
                    <td>${username}</td>
                    <td>${credentials[username].name}</td>
                    <td>${credentials[username].role}</td>
                    <td>
                        ${currentUser.role === 'Team Lead' && username !== currentUser.username ? `
                            <button class="text-red-400 text-sm tooltip" onclick="deleteUser('${username}')" aria-label="Delete user">
                                Delete
                                <span class="tooltiptext">Delete this user</span>
                            </button>
                        ` : ''}
                    </td>
                </tr>
            `).join('');
        }

        function deleteUser(username) {
            if (confirm(`Are you sure you want to delete user ${credentials[username].name}?`)) {
                delete credentials[username];
                localStorage.setItem('credentials', JSON.stringify(credentials));
                populateQADropdowns();
                renderUsersTable();
                showNotification('User deleted successfully');
            }
        }

        // Profile
        function renderProfile() {
            const profile = userProfiles[currentUser.username] || { email: '' };
            document.getElementById('profile-username').value = currentUser.username;
            document.getElementById('profile-role').value = currentUser.role;
            document.getElementById('profile-email').value = profile.email;
        }

        document.getElementById('profile-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const newPassword = document.getElementById('change-password').value;
            if (newPassword) {
                credentials[currentUser.username].password = newPassword;
                localStorage.setItem('credentials', JSON.stringify(credentials));
                showNotification('Password updated successfully');
            }
            userProfiles[currentUser.username] = {
                email: document.getElementById('profile-email').value
            };
            localStorage.setItem('userProfiles', JSON.stringify(userProfiles));
            showNotification('Profile updated successfully');
        });

        // Theme Toggle
        document.getElementById('theme-toggle').addEventListener('change', (e) => {
            const theme = e.target.value;
            document.body.classList.toggle('light-theme', theme === 'light');
            localStorage.setItem('theme', theme);
        });

        // Export Report
        function exportReport() {
            const reportType = document.getElementById('report-type').value;
            const month = document.getElementById('report-month').value;
            const qa = document.getElementById('report-qa').value;
            const projectFilter = document.getElementById('report-project').value.toLowerCase();

            let reportData;
            if (reportType === 'monthly') {
                reportData = projects
                    .filter(p => !projectFilter || p.name.toLowerCase().includes(projectFilter))
                    .filter(p => !qa || p.assignedQA === qa)
                    .filter(p => !month || p.start.startsWith(month))
                    .map(p => ({
                        'Project Name': p.name,
                        'Category': p.category,
                        'QA': credentials[p.assignedQA]?.name || 'N/A',
                        'HTML Bugs': p.htmlBugs,
                        'Functional Bugs': p.funcBugs,
                        'Total Bugs': p.bugs,
                        'Phase': p.phase,
                        'Live Approved': approvedProjects.some(a => a.projectId === p.id) ? 'Yes' : 'No',
                        'Testing Days': Math.ceil((new Date(p.end) - new Date(p.start)) / (1000 * 60 * 60 * 24))
                    }));
            } else if (reportType === 'rejected') {
                reportData = rejectedProjects
                    .filter(r => !projectFilter || r.name.toLowerCase().includes(projectFilter))
                    .filter(r => !qa || r.qa === qa)
                    .filter(r => !month || r.date.startsWith(month))
                    .map(r => ({
                        'Project Name': r.name,
                        'QA': credentials[r.qa]?.name || 'N/A',
                        'Rejected Date': r.date,
                        'Phase': r.phase,
                        'PC': r.pc,
                        'Reason': r.reason
                    }));
            } else if (reportType === 'qa-wise') {
                reportData = tasks
                    .filter(t => !qa || t.assignee === qa)
                    .filter(t => !month || t.assignedDate.startsWith(month))
                    .map(t => {
                        const project = projects.find(p => p.id === t.projectId);
                        return {
                            'QA': credentials[t.assignee]?.name || 'N/A',
                            'Project Name': t.projectName,
                            'Total Bugs': project ? project.bugs : 0,
                            'Tasks Completed': t.status === 'completed' ? 1 : 0
                        };
                    });
            }

            const csv = Papa.unparse(reportData);
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `${reportType}_report_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
            showNotification(`Exported ${reportType} report`);
        }

        // Table Sorting
        function sortTable(tableId, colIndex) {
            const table = document.getElementById(tableId);
            let rows = Array.from(table.rows);
            const isDate = colIndex === 2 || colIndex === 3 || colIndex === 4;

            rows.sort((a, b) => {
                let aValue = a.cells[colIndex].textContent.trim();
                let bValue = b.cells[colIndex].textContent.trim();
                if (isDate) {
                    aValue = new Date(aValue);
                    bValue = new Date(bValue);
                } else if (!isNaN(aValue) && !isNaN(bValue)) {
                    aValue = parseInt(aValue);
                    bValue = parseInt(bValue);
                }
                return aValue > bValue ? 1 : -1;
            });

            table.innerHTML = '';
            rows.forEach(row => table.appendChild(row));
        }

        // Check Due Dates
        setInterval(() => {
            tasks.forEach(task => {
                const dueDate = new Date(task.dueDate);
                const now = new Date();
                if (dueDate - now < 24 * 60 * 60 * 1000 && !task.alertSent && task.status !== 'completed') {
                    showNotification(`Task "${task.name}" is due soon (${task.dueDate})`);
                    task.alertSent = true;
                    localStorage.setItem('tasks', JSON.stringify(tasks));
                }
            });
        }, 60000);
    </script>
</body>
</html>
